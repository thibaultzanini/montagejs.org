function TestWriter(){stream.Writable.call(this)}function TestReader(){stream.Readable.call(this,{highWaterMark:65536})}var common=require("../common.js"),assert=require("assert"),stream=require("../../readable"),chunk=new Buffer("hallo"),util=require("util");util.inherits(TestWriter,stream.Writable),TestWriter.prototype._write=function(e,t,n){n(null)};var dest=new TestWriter;util.inherits(TestReader,stream.Readable),TestReader.prototype._read=function(){this.push(chunk)};for(var src=new TestReader,i=0;10>i;i++)src.pipe(dest),src.unpipe(dest);assert.equal(src.listeners("end").length,0),assert.equal(src.listeners("readable").length,0),assert.equal(dest.listeners("unpipe").length,0),assert.equal(dest.listeners("drain").length,0),assert.equal(dest.listeners("error").length,0),assert.equal(dest.listeners("close").length,0),assert.equal(dest.listeners("finish").length,0),console.error(src._readableState),process.on("exit",function(){assert(src._readableState.length>=src._readableState.highWaterMark),src._readableState.buffer.length=0,console.error(src._readableState)});