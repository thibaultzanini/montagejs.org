var common=require("../common"),assert=require("assert"),Readable=require("../../readable").Readable,r=new Readable,N=262144;process.maxTickDepth=N+2;var reads=0;r._read=function(){var e=reads++===N?null:new Buffer(1);r.push(e)},r.on("readable",function(){r._readableState.length%256||console.error("readable",r._readableState.length),r.read(2*N)});var ended=!1;r.on("end",function(){ended=!0}),r.read(0),process.on("exit",function(){assert(ended),console.log("ok")});