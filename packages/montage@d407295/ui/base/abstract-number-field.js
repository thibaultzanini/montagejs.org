var Montage=require("montage").Montage,AbstractControl=require("ui/base/abstract-control").AbstractControl,KeyComposer=require("composer/key-composer").KeyComposer,Dict=require("collections/dict"),CLASS_PREFIX="montage-NumberField",AbstractNumberField=exports.AbstractNumberField=AbstractControl.specialize({constructor:{value:function AbstractNumberField(){if(this.constructor===AbstractNumberField)throw Error("AbstractNumberField cannot be instantiated.");AbstractControl.constructor.call(this),this._propertyNamesUsed={},this.defineBinding("classList.has('montage--disabled')",{"<-":"!enabled"})}},enterDocument:{value:function(e){if(e){var t=this._propertyNamesUsed;t.min||(this.min=this.element.getAttribute("min")||this._min),t.max||(this.max=this.element.getAttribute("max")||this._max),t.step||(this.step=this.element.getAttribute("step")||this._step),t.value||(this.value=this.element.getAttribute("value")||this._value),delete this._propertyNamesUsed,this._numberFieldTextFieldComponent.addEventListener("action",this,!1),this._numberFieldMinusComponent.addEventListener("action",this,!1),this._numberFieldPlusComponent.addEventListener("action",this,!1),this._numberFieldTextFieldComponent.delegate=this,this.element.addEventListener("mousedown",this,!1),this.element.tabIndex="-1",this._upKeyComposer=KeyComposer.createKey(this,"up","increase"),this._downKeyComposer=KeyComposer.createKey(this,"down","decrease"),this._rightKeyComposer=KeyComposer.createKey(this,"right","increase"),this._leftKeyComposer=KeyComposer.createKey(this,"left","decrease")}}},textFieldShouldBeginEditing:{value:function(){return this.enabled}},textFieldDidChange:{value:function(){}},textFieldDidEndEditing:{value:function(){this.value=this._numberFieldTextFieldComponent.value}},prepareForActivationEvents:{value:function(){this.addEventListener("keyPress",this,!1),this._upKeyComposer.addEventListener("keyPress",null,!1),this._downKeyComposer.addEventListener("keyPress",null,!1),this._leftKeyComposer.addEventListener("keyPress",null,!1),this._rightKeyComposer.addEventListener("keyPress",null,!1)}},draw:{value:function(){this.element.setAttribute("aria-valuemax",this.max),this.element.setAttribute("aria-valuemin",this.min),this.element.setAttribute("aria-valuenow",this.value)}},acceptsActiveTarget:{value:!0},handleMousedown:{value:function(){this.element.focus()}},handlePlusAction:{value:function(){var e="number"==typeof this.min?this.min:0,t=this.value-e;t%this.step?0>t?t-=t%this.step:t+=this.step-t%this.step:t+=this.step,this.value=t+e}},handleMinusAction:{value:function(){var e="number"==typeof this.min?this.min:0,t=this.value-e;t-=t%this.step?t>0?t%this.step:this.step+t%this.step:this.step,this.value=t+e}},handleKeyPress:{value:function(e){this.enabled&&(this.value=this._numberFieldTextFieldComponent.value,"increase"===e.identifier?this.handlePlusAction():"decrease"===e.identifier&&this.handleMinusAction())}},handleAction:{value:function(e){(e.target===this._numberFieldTextFieldComponent||e.target===this._numberFieldMinusComponent||e.target===this._numberFieldPlusComponent)&&(e.stopPropagation(),this.dispatchActionEvent())}},_value:{value:0},_required:{value:!1},_min:{value:"any"},_max:{value:"any"},_step:{value:1},min:{get:function(){return this._min},set:function(e){return"any"!==e&&isNaN(e=parseFloat(e))?!1:(this._min!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.min=!0),this._min=e,this.needsDraw=!0,"number"==typeof e&&e>this.value&&(this.value=e)),void 0)}},max:{get:function(){return this._max},set:function(e){return"any"!==e&&isNaN(e=parseFloat(e))?!1:(this._max!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.max=!0),this._max=e,this.needsDraw=!0,"number"==typeof e&&this.value>e&&(this.value=e)),void 0)}},step:{get:function(){return this._step},set:function(e){return isNaN(e=parseFloat(e))||0>=e?!1:(this._step!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.step=!0),this._step=e),void 0)}},value:{get:function(){return this._value},set:function(e){isNaN(e=parseFloat(e))||("number"==typeof this.min&&this.min>e&&(e=this.min),"number"==typeof this.max&&e>this.max&&(e=this.max),this._value!==e&&(this._propertyNamesUsed&&(this._propertyNamesUsed.value=!0),this._value=e,this.needsDraw=!0)),this._numberFieldTextFieldComponent&&this._value!==this._numberFieldTextFieldComponent.value&&(this._numberFieldTextFieldComponent.value=this._value)}},enabled:{value:!0},_numberFieldTextFieldComponent:{value:null},_numberFieldMinusComponent:{value:null},_numberFieldPlusComponent:{value:null}});