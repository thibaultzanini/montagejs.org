montageDefine("a005228","ui/photo-editor.reel/photo-editor",{dependencies:["montage","montage/ui/component","montage/ui/dom","montage/core/geometry/point","core/effect/desaturate-effect","core/effect/invert-effect","core/effect/sepia-effect","core/effect/multiply-effect"],factory:function(e,t,n){var r=e("montage").Montage,i=e("montage/ui/component").Component,s=e("montage/ui/dom"),o=e("montage/core/geometry/point").Point,u=e("core/effect/desaturate-effect").DesaturateEffect,a=e("core/effect/invert-effect").InvertEffect,f=e("core/effect/sepia-effect").SepiaEffect,l=e("core/effect/multiply-effect").MultiplyEffect,c="https://lh5.googleusercontent.com/-M9uCIhQjy3c/TwTSfmO6MlI/AAAAAAAAFcw/BIMvbz3a7Z4/s1/blank.jpg";t.PhotoEditor=r.create(i,{supportsCrossOriginCanvas:{value:null},didCreate:{value:function(){this._testCrossOriginCanvas()}},_testCrossOriginCanvas:{value:function(){var e,t,n,r=this;e=document.createElement("img"),e.crossOrigin="",e.src=c,e.onload=function(){t=document.createElement("canvas"),n=t.getContext("2d"),n.drawImage(e,0,0,1,1);try{n.getImageData(0,0,1,1),r.supportsCrossOriginCanvas=!0}catch(i){if(18!==i.code)throw i;r.supportsCrossOriginCanvas=!1}}}},__image:{value:null},_image:{get:function(){return this.__image},set:function(e){if(this.__image===e)return;this.__image&&this.__image.element.removeEventListener("load",this,!1),this.__image=e,this.__image.element.identifier="editorImage",this.__image&&this.__image.element.addEventListener("load",this,!1)}},_canvas:{value:null},_toolLayer:{value:null},_pointerIdentifier:{value:null},prepareForActivationEvents:{value:function(){window.Touch?this._canvas.addEventListener("touchstart",this,!1):this._canvas.addEventListener("mousedown",this,!1)}},handleMousedown:{value:function(e){if(e.button!==0)return;e.preventDefault(),this._pointerIdentifier="mouse",document.addEventListener("mousemove",this,!1),document.addEventListener("mouseup",this,!1),this._pickColor(e.pageX,e.pageY);var t=s.convertPointFromPageToNode(this._canvas,o.create().init(e.pageX,e.pageY));this.horizontalRuler&&(this.horizontalRuler.savedPosition=t.x),this.verticalRuler&&(this.verticalRuler.savedPosition=t.y),this.needsDraw=!0}},handleTouchstart:{value:function(e){if(this._pointerIdentifier)return;e.preventDefault();var t=e.changedTouches[0];this._pointerIdentifier=t.identifier,this._canvas.addEventListener("touchmove",this,!1),document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1),this._pickColor(t.pageX,t.pageY)}},handleMouseup:{value:function(e){if(e.button!==0)return;this._pointerIdentifier=null,document.removeEventListener("mousemove",this,!1),document.removeEventListener("mouseup",this,!1),this._pickColor(e.pageX,e.pageY,!0),this.horizontalRuler&&(this.horizontalRuler.savedPosition=null),this.verticalRuler&&(this.verticalRuler.savedPosition=null),this.needsDraw=!0}},handleMousemove:{value:function(e){if(!this._pointerIdentifier)return;this._pickColor(e.pageX,e.pageY)}},handleTouchmove:{value:function(e){var t=0,n,r=null;for(;n=e.changedTouches[t];t++)if(n.identifier===this._pointerIdentifier){r=n;break}if(!r)return;this._pickColor(r.pageX,r.pageY)}},handleTouchend:{value:function(){var e=0,t,n=null;for(;t=event.changedTouches[e];e++)if(t.identifier===this._pointerIdentifier){n=t;break}if(!n)return;this._pointerIdentifier=null,this._pickColor(n.pageX,n.pageY,!0)}},_pickColor:{value:function(e,t,n){var r=20,i=10,u=this._canvas,a=u.getContext("2d"),f=s.convertPointFromPageToNode(u,o.create().init(e,t)),l=a.getImageData(f.x,f.y,1,1),c=a.getImageData(f.x-i,f.y-i,r,r),h;h=document.createEvent("CustomEvent"),h.initCustomEvent(n?"colorpickend":"colorpick",!0,!0,null),h.color=[l.data[0],l.data[1],l.data[2],l.data[3]],h.focusGrid=c,h.pageX=e,h.pageY=t,h.canvasX=f.x,h.canvasY=f.y,this.dispatchEvent(h)}},dataAtPoint:{value:function(e,t){if(!this.hasImage||!this._canvas||e<0||e>this._width||t<0||t>this._height)return null;var n=this._canvas,r=n.getContext("2d"),i=r.getImageData(e,t,1,1).data;return[i[0],i[1],i[2],i[3]]}},_photo:{value:null},photo:{get:function(){return this._photo},set:function(e){if(e===this._photo)return;this._photo=e,this._photo||(this.hasImage=!1,this.needsDraw=!0)}},hasImage:{value:!1},handleEditorImageLoad:{value:function(e){this._imageDirty=!0,this.hasImage=!0,this.needsDraw=!0}},_width:{value:null},_height:{value:null},currentColor:{value:null},_inverted:{value:!1},inverted:{get:function(){return this._inverted},set:function(e){if(e===this._inverted)return;this._inverted=e,this._imageDirty=!0,this.needsDraw=!0}},_desaturated:{value:!1},desaturated:{get:function(){return this._desaturated},set:function(e){if(e===this._desaturated)return;this._desaturated=e,this._imageDirty=!0,this.needsDraw=!0}},_sepiaToned:{value:!1},sepiaToned:{get:function(){return this._sepiaToned},set:function(e){if(e===this._sepiaToned)return;this._sepiaToned=e,this._imageDirty=!0,this.needsDraw=!0}},_multiplyEffect:{value:!1},multiplyEffect:{get:function(){return this._multiplyEffect},set:function(e){if(e===this._multiplyEffect)return;this._multiplyEffect=e,this._imageDirty=!0,this.needsDraw=!0}},_multiplyMultiplier:{value:1},multiplyMultiplier:{get:function(){return this._multiplyMultiplier},set:function(e){if(e===this._multiplyMultiplier)return;this._multiplyMultiplier=e,this.multiplyEffect&&(this._imageDirty=!0,this.needsDraw=!0)}},prepareForDraw:{value:function(){this._image.element.crossOrigin="";var e=this._canvas.cloneNode(!0);this._canvas.parentNode.replaceChild(e,this._canvas),this._canvas=e}},horizontalRuler:{value:null},verticalRuler:{value:null},pointMonitorController:{value:null},_isShowingPointMonitors:{value:null},isShowingPointMonitors:{get:function(){return this._isShowingPointMonitors},set:function(e){if(e===this._isShowingPointMonitors)return;this._isShowingPointMonitors=e,this.needsDraw=!0}},willDraw:{value:function(){this._width=this._image.element.offsetWidth,this._height=this._image.element.offsetHeight}},draw:{value:function(){if(!this._width||!this._height)return;var e=this._width,t=this._height,n,r,i;this._toolLayer.style.width=e+"px",this._toolLayer.style.height=t+"px",this._isShowingPointMonitors?this.element.classList.add("isShowingPointMonitors"):this.element.classList.remove("isShowingPointMonitors"),this._pointerIdentifier?this.element.classList.add("pickingColor"):this.element.classList.remove("pickingColor"),this.hasImage?this.element.classList.add("hasImage"):this.element.classList.remove("hasImage");if(!this._imageDirty)return;n=this._canvas,r=this._image.element,i,n.width=e,n.height=t,i=n.getContext("2d"),i.drawImage(r,0,0);var s=i.getImageData(0,0,e,t),o=s.data,c=o.length;this.inverted&&a.applyEffect(o,c),this.desaturated&&u.applyEffect(o,c),this.sepiaToned&&f.applyEffect(o,c),this.multiplyEffect&&l.applyEffect(o,c,this.multiplyMultiplier),i.putImageData(s,0,0)}},didDraw:{value:function(){if(this._imageDirty){var e=document.createEvent("CustomEvent");e.initCustomEvent("imagemodified",!0,!0,{editor:this}),this.dispatchEvent(e),this._imageDirty=!1}}}})}}),montageDefine("120b0c7","ui/composer/press-composer",{dependencies:["montage","ui/composer/composer","core/event/mutable-event"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/composer/composer").Composer,s=e("core/event/mutable-event").MutableEvent,o=t.PressComposer=r.create(i,{load:{value:function(){window.Touch?this._element.addEventListener("touchstart",this,!0):this._element.addEventListener("mousedown",this,!0)}},unload:{value:function(){window.Touch?this._element.removeEventListener("touchstart",this):this._element.removeEventListener("mousedown",this)}},delegate:{value:null},cancelPress:{value:function(){return this._state===o.PRESSED?(this._dispatchPressCancel(),this._endInteraction(),!0):!1}},addEventListener:{value:function(e,t,n){i.addEventListener.call(this,e,t,n),e==="longPress"&&(this._shouldDispatchLongPress=!0)}},UNPRESSED:{value:0},PRESSED:{value:1},CANCELLED:{value:2},_state:{enumerable:!1,value:0},state:{get:function(){return this._state}},_shouldDispatchLongPress:{enumerable:!1,value:!1},_longPressThreshold:{enumerable:!1,value:1e3},longPressThreshold:{get:function(){return this._longPressThreshold},set:function(e){this._longPressThreshold!==e&&(this._longPressThreshold=e)}},_longPressTimeout:{enumberable:!1,value:null},_observedPointer:{enumerable:!1,value:null},_startInteraction:{enumerable:!1,value:function(e){if("disabled"in this.component&&this.component.disabled||this._observedPointer!==null)return!1;var t=0,n;if(e.type==="touchstart"){n=e.changedTouches.length;for(;t<n;t++)if(!this.component.eventManager.componentClaimingPointer(e.changedTouches[t].identifier)){this._observedPointer=e.changedTouches[t].identifier;break}if(this._observedPointer===null)return!1;document.addEventListener("touchend",this,!1),document.addEventListener("touchcancel",this,!1)}else e.type==="mousedown"&&(this._observedPointer="mouse",document.addEventListener("mouseup",this,!1),document.addEventListener("click",this,!1));this._element.addEventListener("dragstart",this,!1),this.component.eventManager.claimPointer(this._observedPointer,this),this._dispatchPressStart(e)}},_interpretInteraction:{value:function(e){var t,n,r;if(this._observedPointer===null){this._endInteraction(e);return}t=!this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this),n=e.target;while(n!==this._element&&n&&n.parentNode)n=n.parentNode;r=n===this._element;if(t&&e.type==="click"){e.preventDefault(),this._endInteraction(e);return}if(e.type==="mouseup"){if(!t&&r){this._dispatchPress(e),this._endInteraction(e);return}if(!t&&!r){this._dispatchPressCancel(e),this._endInteraction(e);return}t&&!r&&this._endInteraction(e)}}},_endInteraction:{value:function(e){if(!e||e.type==="touchend"||e.type==="touchcancel")document.removeEventListener("touchend",this),document.removeEventListener("touchcancel",this);else if(!e||e.type==="click"||e.type==="mouseup")document.removeEventListener("click",this),document.removeEventListener("mouseup",this);this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this.component.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null,this._state=o.UNPRESSED}},_changedTouchisObserved:{value:function(e){if(this._observedPointer===null)return!1;var t=0,n=event.changedTouches.length;for(;t<n;t++)if(event.changedTouches[t].identifier===this._observedPointer)return t;return!1}},surrenderPointer:{value:function(e,t){var n=this.callDelegateMethod("surrenderPointer",e,t);return typeof n!="undefined"&&n===!1?!1:(this._dispatchPressCancel(),!0)}},captureTouchstart:{value:function(e){this._startInteraction(e)}},handleTouchend:{value:function(e){if(this._observedPointer===null){this._endInteraction(e);return}this._changedTouchisObserved(e.changedTouches)!==!1&&(this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)?this._dispatchPress(e):e.preventDefault(),this._endInteraction(e))}},handleTouchcancel:{value:function(e){if(this._observedPointer===null||this._changedTouchisObserved(e.changedTouches)!==!1)this.component.eventManager.isPointerClaimedByComponent(this._observedPointer,this)&&this._dispatchPressCancel(e),this._endInteraction(e)}},captureMousedown:{value:function(e){this._startInteraction(e)}},handleClick:{value:function(e){this._interpretInteraction(e)}},handleMouseup:{value:function(e){this._interpretInteraction(e)}},handleDragstart:{value:function(e){this._dispatchPressCancel(e),this._endInteraction()}},_createPressEvent:{enumerable:!1,value:function(e,t){var n,r,i;return t||(t=document.createEvent("CustomEvent"),t.initCustomEvent(e,!0,!0,null)),n=u.create(),n.event=t,n.type=e,n.pointer=this._observedPointer,t.changedTouches&&(i=this._changedTouchisObserved(t.changedTouches))!==!1&&(n.touch=t.changedTouches[i]),n}},_dispatchPressStart:{enumerable:!1,value:function(e){this._state=o.PRESSED,this.dispatchEvent(this._createPressEvent("pressStart",e));if(this._shouldDispatchLongPress){var t=this;this._longPressTimeout=setTimeout(function(){t._dispatchLongPress()},this._longPressThreshold)}}},_dispatchPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this.dispatchEvent(this._createPressEvent("press",e)),this._state=o.UNPRESSED}},_dispatchLongPress:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(this.dispatchEvent(this._createPressEvent("longPress",e)),this._longPressTimeout=null)}},_dispatchPressCancel:{enumerable:!1,value:function(e){this._shouldDispatchLongPress&&(clearTimeout(this._longPressTimeout),this._longPressTimeout=null),this._state=o.CANCELLED,this.dispatchEvent(this._createPressEvent("pressCancel",e))}}}),u=function(){var e,t,n,i,s,o;e=r.create(r,{type:{value:"press"},_event:{enumerable:!1,value:null},event:{get:function(){return this._event},set:function(e){this._event=e}},_touch:{enumerable:!1,value:null},touch:{get:function(){return this._touch},set:function(e){this._touch=e}}}),t=["altKey","ctrlKey","metaKey","shiftKey","cancelBubble","currentTarget","defaultPrevented","eventPhase","timeStamp","preventDefault","stopImmediatePropagation","stopPropagation"],n=["clientX","clientY","pageX","pageY","screenX","screenY","target"],i=function(e){return{get:function(){return this._event[e]}}},s=function(e){return{get:function(){return this._touch?this._touch[e]:this._event[e]}}};for(o=t.length-1;o>=0;o--)r.defineProperty(e,t[o],i(t[o]));for(o=n.length-1;o>=0;o--)r.defineProperty(e,n[o],s(n[o]));return e}()}}),montageDefine("a005228","ui/main.reel/main",{dependencies:["montage","montage/ui/component","montage/ui/popup/popup.reel","montage/core/serializer","montage/core/deserializer","montage/core/undo-manager","montage/ui/controller/array-controller","montage/core/promise"],factory:function(e,t,n){var r=e("montage").Montage,i=e("montage/ui/component").Component,s=e("montage/ui/popup/popup.reel").Popup,o=e("montage/core/serializer").Serializer,u=e("montage/core/deserializer").Deserializer,a=e("montage/core/undo-manager").defaultUndoManager,f=e("montage/ui/controller/array-controller").ArrayController,l="montage_photofx_state",c=e("montage/core/promise").Promise;t.Main=r.create(i,{didCreate:{value:function(){this.undoManager=a,this.photoController=f.create(),this._loadPhotos()}},_loadPhotos:{value:function(){var t,n,r;if(localStorage){t=localStorage.getItem(l);if(t){n=u.create(),r=this;try{n.initWithStringAndRequire(t,e).deserializeObject(function(e){r.photoController.content=e.photos},e)}catch(i){console.error("Could not load saved state."),console.debug("Could not deserialize",t),console.log(i.stack)}}}!this.photoController.content&&!t&&(this.photoController.content=[{src:"images/IMG_1337.jpg",thumbnailSrc:"images/IMG_1337_thumb.jpg",title:"Piston",authors:["mike"],id:"4692177F-8C28-4273-99A5-DB453EF2767C"},{src:"images/IMG_1375.jpg",thumbnailSrc:"images/IMG_1375_thumb.jpg",title:"Big Sky",authors:["mike"],id:"89C81183-BB4C-4FAB-93B2-F193A54FF8CF"},{src:"images/IMG_1414.jpg",thumbnailSrc:"images/IMG_1414_thumb.jpg",title:"5771",authors:["mike"],id:"9797A89D-6EC6-4AC1-A568-87A42D04915A"},{src:"images/IMG_1416.jpg",thumbnailSrc:"images/IMG_1416_thumb.jpg",title:"Horizon",authors:["mike"],id:"61E19879-7E28-4D53-AECE-F1D80D9EDE0A"}])}},_testCrossOriginCanvas:{value:function(){var e,t,n,r=this;e=document.createElement("img"),e.crossOrigin="",e.src=CORS_TEST_IMAGE,e.onload=function(){t=document.createElement("canvas"),n=t.getContext("2d"),n.drawImage(e,0,0,1,1);try{n.getImageData(0,0,1,1),r.supportsCrossOriginCanvas=!0}catch(i){if(18!==i.code)throw i;r.supportsCrossOriginCanvas=!1}}}},photoController:{value:null},prepareForDraw:{value:function(){document.addEventListener("mousedown",this,!1),window.addEventListener("beforeunload",this,!0),this.element.addEventListener("dragenter",this,!1),this.element.addEventListener("dragleave",this,!1),this.element.addEventListener("dragover",this,!1),this.element.addEventListener("drop",this,!1),this.element.addEventListener("dragend",this,!1),window.Touch&&this.element.classList.add("touch")}},handleMousedown:{value:function(e){e.button===1&&(this.showControls=!this._showControls)}},_showControls:{value:!0},showControls:{get:function(){return this._showControls},set:function(e){if(e===this._showControls)return;this._showControls=e,this.needsDraw=!0}},handleDragenter:{value:function(e){e.dataTransfer.types.indexOf("Files")>=0?this.willingToAcceptDrop=!0:(e.dataTransfer.effectAllowed="none",e.dataTransfer.dropEffect="none")}},handleDragleave:{value:function(e){this.willingToAcceptDrop=!1}},handleDragover:{value:function(e){e.preventDefault()}},handleDrop:{value:function(e){e.stopPropagation(),e.preventDefault();if(!this.willingToAcceptDrop)return;var t=e.dataTransfer.files,n,r;for(n=0;r=t[n];n++){if(!r.type.match(/image.*/))continue;var i=new FileReader;i.onload=function(e,t){return function(n){var r={src:n.target.result,title:t.name};e.photoController.addObjects(r)}}(this,r),i.readAsDataURL(r)}}},handleDragend:{value:function(e){this.willingToAcceptDrop=!1}},_willingToAcceptDrop:{value:!1},willingToAcceptDrop:{get:function(){return this._willingToAcceptDrop},set:function(e){if(e===this._willingToAcceptDrop)return;this._willingToAcceptDrop=e,this.needsDraw=!0}},captureBeforeunload:{value:function(){this.saveState()}},saveState:{value:function(){if(!localStorage)return;var t={photos:this.photoController.organizedObjects},n=o.create().initWithRequire(e);localStorage.setItem(l,n.serializeObject(t))}},searchPanel:{value:null},photoEditor:{value:null},searchPopup:{value:null},handleAddPhotosButtonAction:{value:function(){if(!this.photoEditor.supportsCrossOriginCanvas)return;var e=this.searchPopup;e||(e=s.create(),e.content=this.searchPanel,this.searchPopup=e),e.show()}},handleRemovePhotoButtonAction:{value:function(){if(!this.photoEditor.supportsCrossOriginCanvas)return;var e=this.photoController.getProperty("selectedObjects.0");if(!e)return;var t=this.photoController.content.indexOf(e);this.removePhotoAtIndex(t)}},handleUndoButtonAction:{value:function(){this.undoManager.undo()}},handleRedoButtonAction:{value:function(){this.undoManager.redo()}},removePhotoAtIndex:{value:function(e){var t=this.photoController.content[e],n='remove photo "'+t.title+'"';this.undoManager.register(n,c.resolve([this.addPhotoAtIndex,this,t,e])),this.photoController.removeObjects(t)}},addPhotoAtIndex:{value:function(e,t){var n='add photo "'+e.title+'"';this.undoManager.register(n,c.resolve([this.removePhotoAtIndex,this,t])),this.photoController.content.splice(t,0,e),this.photoController.selectedObjects=[e]}},draw:{value:function(){this.showControls?this.element.classList.add("showControls"):this.element.classList.remove("showControls"),this.willingToAcceptDrop?this.element.classList.add("acceptsDrop"):this.element.classList.remove("acceptsDrop")}}})}}),montageDefine("a005228","ui/main.reel/main.html",{text:'<!doctype html>\n\n<html>\n<head>\n    <meta http-equiv=Content-Type content="text/html; charset=utf-8">\n    <title>PhotoFX Main</title>\n    <link rel=stylesheet type="text/css" href=main.css>\n\n    <script type="text/montage-serialization">{"negationConverter":{"prototype":"core/negation-converter"},"gridMagnifier":{"prototype":"ui/grid-magnifier.reel","properties":{"element":{"#":"gridMagnifier"},"followPointer":true},"bindings":{"colorPickerEnabled":{"<-":"@owner.showControls","converter":{"@":"negationConverter"}}}},"photoEditor":{"prototype":"ui/photo-editor.reel","properties":{"element":{"#":"editor"}},"bindings":{"photo":{"<-":"@owner.photoController.selectedObjects.0"}}},"effectsPanel":{"prototype":"ui/effects-panel.reel","properties":{"element":{"#":"effectsPanel"},"editor":{"@":"photoEditor"}}},"photoThumb":{"prototype":"ui/photo-thumb.reel","properties":{"element":{"#":"photoThumb"}},"bindings":{"photo":{"<-":"@photoList.objectAtCurrentIteration"}}},"photoList":{"prototype":"montage/ui/list.reel","properties":{"element":{"#":"photoList"},"axis":"horizontal","isSelectionEnabled":true},"bindings":{"contentController":{"<-":"@owner.photoController"}}},"supportsCrossOriginCanvasCondition":{"prototype":"montage/ui/condition.reel","properties":{"element":{"#":"supportsCrossOriginCanvasCondition"}},"bindings":{"condition":{"<-":"@owner.photoEditor.supportsCrossOriginCanvas"}}},"addPhotosButton":{"prototype":"montage/ui/button.reel","properties":{"element":{"#":"addPhotosButton"},"identifier":"addPhotosButton"},"listeners":[{"type":"action","listener":{"@":"owner"},"capture":false}]},"removeSelectionCondition":{"prototype":"montage/ui/condition.reel","properties":{"element":{"#":"removeSelectionCondition"},"removalStrategy":"hide"},"bindings":{"condition":{"<-":"@owner.photoController.selectedObjects.0"}}},"removePhotoButton":{"prototype":"montage/ui/button.reel","properties":{"element":{"#":"removePhotoButton"},"identifier":"removePhotoButton"},"listeners":[{"type":"action","listener":{"@":"owner"},"capture":false}]},"searchPanel":{"prototype":"ui/search-panel.reel","bindings":{"photoListController":{"<-":"@owner.photoController"}}},"owner":{"properties":{"element":{"#":"main"},"searchPanel":{"@":"searchPanel"},"photoEditor":{"@":"photoEditor"}}},"toggleControlsButton":{"prototype":"montage/ui/toggle-button.reel","properties":{"element":{"#":"toggleControlsButton"}},"bindings":{"pressed":{"<->":"@owner.showControls"}}},"undoButton":{"prototype":"montage/ui/button.reel","properties":{"element":{"#":"undoButton"},"identifier":"undoButton"},"bindings":{"label":{"<-":"@owner.undoManager.undoLabel"},"enabled":{"<-":"@owner.undoManager.canUndo"}},"listeners":[{"type":"action","listener":{"@":"owner"},"capture":false}]},"redoButton":{"prototype":"montage/ui/button.reel","properties":{"element":{"#":"redoButton"},"identifier":"redoButton"},"bindings":{"label":{"<-":"@owner.undoManager.redoLabel"},"enabled":{"<-":"@owner.undoManager.canRedo"}},"listeners":[{"type":"action","listener":{"@":"owner"},"capture":false}]}}</script>\n\n</head>\n<body>\n\n    <div data-montage-id=main class="PhotoFX main">\n\n        <div class=mainMenu>\n            <button data-montage-id=toggleControlsButton class="btn primary ToggleControlsButton">✎</button>\n            <button data-montage-id=undoButton class="btn UndoButton">⤺ </button>\n            <button data-montage-id=redoButton class="btn RedoButton">⤻ </button>\n        </div>\n\n        <div class=editArea>\n            <div data-montage-id=gridMagnifier></div>\n            <div data-montage-id=editor></div>\n        </div>\n\n        <div data-montage-id=effectsPanel class=floatingPanel></div>\n\n        <div class="PhotoPanel floatingPanel">\n            <div data-montage-id=photoList class=PhotoList>\n                <div data-montage-id=photoThumb></div>\n            </div>\n            <div data-montage-id=supportsCrossOriginCanvasCondition>\n                <div class=controlPanel>\n                    <button data-montage-id=addPhotosButton class="text AddPhotosButton btn success">Add Photos…</button>\n                    <div data-montage-id=removeSelectionCondition>\n                        <button data-montage-id=removePhotoButton class="text RemovePhotosButton btn danger">Remove Photo</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n    </div>\n\n</body>\n</html>'}),montageDefine("120b0c7","ui/text-input",{dependencies:["montage","ui/component","ui/native-control"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/native-control").NativeControl,o=t.TextInput=r.create(s,{_hasFocus:{enumerable:!1,value:!1},_value:{enumerable:!1,value:null},_valueSyncedWithInputField:{enumerable:!1,value:!1},value:{get:function(){return this._value},set:function(e,t){if(e!==this._value){if(this.converter){var n;try{n=this.converter.revert(e),this.error=null,this._value=n}catch(r){this._value=e,this.error=r}}else this._value=e;t?this._valueSyncedWithInputField=!0:(this._valueSyncedWithInputField=!1,this.needsDraw=!0)}}},_setValue:{value:function(){var e=this.element.value;Object.getPropertyDescriptor(this,"value").set.call(this,e,!0)}},converter:{value:null},_error:{value:null},error:{get:function(){return this._error},set:function(e){this._error=e,this.errorMessage=this._error?this._error.message:null,this.needsDraw=!0}},_errorMessage:{value:null},errorMessage:{get:function(){return this._errorMessage},set:function(e){this._errorMessage=e}},_updateOnInput:{value:!0},updateOnInput:{get:function(){return!!this._updateOnInput},set:function(e){this._updateOnInput=e}},blur:{value:function(){this._element.blur()}},focus:{value:function(){this._element.focus()}},prepareForDraw:{enumerable:!1,value:function(){var e=this.element;e.addEventListener("focus",this),e.addEventListener("input",this),e.addEventListener("change",this),e.addEventListener("blur",this)}},_setElementValue:{value:function(e){this.element.value=e==null?"":e}},draw:{enumerable:!1,value:function(){Object.getPrototypeOf(o).draw.call(this);var e=this.element;this._valueSyncedWithInputField||this._setElementValue(this.converter?this.converter.convert(this._value):this._value),this.error?(e.classList.add("montage--invalidText"),e.title=this.error.message||""):(e.classList.remove("montage--invalidText"),e.title="")}},didDraw:{enumerable:!1,value:function(){if(this._hasFocus&&this._value!=null){var e=this._value.toString().length;this.element.setSelectionRange(e,e)}this._valueSyncedWithInputField=!0}},handleInput:{enumerable:!1,value:function(){this.converter?this.converter.allowPartialConversion===!0&&this.updateOnInput===!0&&this._setValue():this._setValue()}},handleChange:{enumerable:!1,value:function(e){this._setValue(),this._hasFocus=!1}},handleBlur:{enumerable:!1,value:function(e){this._hasFocus=!1}},handleFocus:{enumerable:!1,value:function(e){this._hasFocus=!0}}});o.addAttributes({accept:null,alt:null,autocomplete:null,autofocus:{dataType:"boolean"},checked:{dataType:"boolean"},dirname:null,disabled:{dataType:"boolean"},form:null,formaction:null,formenctype:null,formmethod:null,formnovalidate:{dataType:"boolean"},formtarget:null,height:null,list:null,maxlength:null,multiple:{dataType:"boolean"},name:null,pattern:null,placeholder:null,readonly:{dataType:"boolean"},required:{dataType:"boolean"},size:null,src:null,width:null})}}),montageDefine("a005228","ui/grid-magnifier.reel/grid-magnifier",{dependencies:["montage","montage/ui/component","montage/ui/dom","montage/core/geometry/point"],factory:function(e,t,n){var r=e("montage").Montage,i=e("montage/ui/component").Component,s=e("montage/ui/dom"),o=e("montage/core/geometry/point").Point;t.GridMagnifier=r.create(i,{_loupe:{value:null,serializable:!0},_canvas:{value:null},_grid:{value:null},grid:{get:function(){return this._grid},set:function(e){if(e===this._grid)return;this._grid=e,this.needsDraw=!0}},_width:{value:null},_height:{value:null},_pageCenterX:{value:null},_pageCenterY:{value:null},x:{value:null},y:{value:null},color:{value:null},colorPickerEnabled:{value:!1},handleColorpick:{value:function(e){this._pageCenterX=e.pageX,this._pageCenterY=e.pageY,this.x=e.canvasX,this.y=e.canvasY,this.grid=e.focusGrid,this.color=e.color,document.application.addEventListener("colorpickend",this,!1)}},handleColorpickend:{value:function(){document.application.removeEventListener("colorpickend",this,!1),this._pageCenterX=null,this._pageCenterY=null,this.grid=null}},_followPointer:{value:!1,serializable:!0},followPointer:{get:function(){return this._followPointer},set:function(e){if(e===this._followPointer)return;this._followPointer=e,this.needsDraw=!0}},prepareForDraw:{value:function(){document.application.addEventListener("colorpick",this,!1);var e=this._canvas.cloneNode(!0);this._canvas.parentNode.replaceChild(e,this._canvas),this._canvas=e,this._context=this._canvas.getContext("2d")}},willDraw:{value:function(){this._width=this._loupe.offsetWidth,this._height=this._loupe.offsetHeight}},draw:{value:function(){if(!this._width||!this._height||!this.grid){this.element.classList.remove("active");return}this.element.classList.add("active"),this.followPointer?this.element.classList.remove("stationary"):this.element.classList.add("stationary");var e=10,t=this._pageCenterX-this._width/2-e/2,n=this._pageCenterY-this._height/2-e/2,r=s.convertPointFromPageToNode(this.element.parentNode,o.create().init(t,n)),i=this.grid.data,u=this._context,a,f,l=0,c=Math.floor(this._width/e),h=Math.floor(this._height/e);this.followPointer?this.element.style.webkitTransform="translate3d("+r.x+"px, "+r.y+"px , 0)":this.element.style.webkitTransform="translate3d(0, 0, 0)",u.clearRect(0,0,this._width,this._height);for(f=0;f<c;f++)for(a=0;a<h;a++)u.fillStyle="rgba("+i[l]+","+i[l+1]+","+i[l+2]+","+i[l+3]+")",u.fillRect(a*e,f*e,e,e),l+=4;u.globalAlpha=.1,u.globalCompositeOperation="xor",u.strokeStyle="#000",u.lineWidth=1,u.beginPath();for(a=0;a<=this._width;a+=e)u.moveTo(a,0),u.lineTo(a,this._height);for(f=0;f<=this._height;f+=e)u.moveTo(0,f),u.lineTo(this._width,f);u.stroke(),u.closePath(),u.globalAlpha=1,u.globalCompositeOperation="source-over",u.strokeRect(Math.floor(h/2)*e,Math.floor(c/2)*e,e,e)}}})}}),montageDefine("120b0c7","ui/toggle-button.reel/toggle-button",{dependencies:["montage","ui/component","ui/button.reel"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/button.reel").Button,o=t.ToggleButton=r.create(s,{hasTemplate:{value:!0},_pressed:{value:!1},pressed:{get:function(){return this._pressed},set:function(e){this._pressed=!!e,this._label=this._pressed?this._pressedLabel:this._unpressedLabel,this.needsDraw=!0}},_unpressedLabel:{value:null},unpressedLabel:{get:function(){return this._unpressedLabel},set:function(e){this._unpressedLabel=e,this._pressed||(this.label=this._unpressedLabel,this.needsDraw=!0)}},_pressedLabel:{value:null},pressedLabel:{get:function(){return this._pressedLabel},set:function(e){this._pressedLabel=e,this._pressed&&(this.label=this._pressedLabel,this.needsDraw=!0)}},_pressedClass:{value:"pressed"},pressedClass:{get:function(){return this._pressedClass},set:function(e){this._pressedClass=e,this._pressed&&(this.needsDraw=!0)}},label:{get:function(){return Object.getPropertyDescriptor(s,"label").get.call(this)},set:function(e){Object.getPropertyDescriptor(s,"label").set.call(this,e),this._pressed===!0&&this._label===this._unpressedLabel?this.pressed=!1:this._pressed===!1&&this._label===this._pressedLabel&&(this.pressed=!0)}},setLabelInitialValue:{value:function(e){this._label===null&&(this._label=e)}},willPrepareForDraw:{value:function(){Object.getPrototypeOf(o).willPrepareForDraw.call(this),this._unpressedLabel===null&&this._label!==null&&(this._unpressedLabel=this._label),this._pressedLabel===null&&this._label!==null&&(this._pressedLabel=this._label)}},draw:{value:function(){Object.getPrototypeOf(o).draw.call(this),this._pressed?(this._element.classList.add(this._pressedClass),this._element.setAttribute("aria-pressed",!0)):(this._element.classList.remove(this._pressedClass),this._element.setAttribute("aria-pressed",!1))}},_dispatchActionEvent:{value:function(){this.pressed=!this._pressed,Object.getPrototypeOf(o)._dispatchActionEvent.call(this)}},toggle:{value:function(){this.pressed=!this._pressed}}})}}),montageDefine("a005228","ui/color-info-panel.reel/color-info-panel.html",{text:'<!doctype html>\n\n<html>\n<head>\n    <meta http-equiv=Content-Type content="text/html; charset=utf-8">\n    <title>ColorInfoPanel</title>\n    <link rel=stylesheet type="text/css" href=color-info-panel.css>\n\n    <script type="text/montage-serialization">{"owner":{"properties":{"element":{"#":"ColorInfoPanel"}}},"pointMonitorRepetition":{"prototype":"montage/ui/repetition.reel","properties":{"element":{"#":"pointMonitors"},"isSelectionEnabled":true},"bindings":{"contentController":{"<-":"@owner.pointMonitorController"}}},"colorPicker":{"prototype":"ui/color-picker.reel","properties":{"element":{"#":"colorPicker"}},"bindings":{"currentColor":{"<-":"@pointMonitorRepetition.objectAtCurrentIteration.color"},"x":{"<-":"@pointMonitorRepetition.objectAtCurrentIteration.x"},"y":{"<-":"@pointMonitorRepetition.objectAtCurrentIteration.y"}}},"addMonitorButton":{"prototype":"montage/ui/button.reel","properties":{"element":{"#":"addMonitorButton"},"identifier":"addMonitorButton"},"listeners":[{"type":"action","listener":{"@":"owner"},"capture":false}]},"removeMonitorButton":{"prototype":"montage/ui/button.reel","properties":{"element":{"#":"removeMonitorButton"},"identifier":"removeMonitorButton"},"listeners":[{"type":"action","listener":{"@":"owner"},"capture":false}]}}</script>\n\n</head>\n<body>\n\n    <div data-montage-id=ColorInfoPanel class=ColorInfoPanel>\n        <div data-montage-id=pointMonitors>\n            <div data-montage-id=colorPicker></div>\n        </div>\n\n        <div class=panel>\n            <button data-montage-id=addMonitorButton class=btn>+</button>\n            <button data-montage-id=removeMonitorButton class=btn>-</button>\n        </div>\n    </div>\n\n</body>\n</html>'}),montageDefine("120b0c7","ui/scroller.reel/scroller.html",{text:'<!DOCTYPE html>\n\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=scroller.css>\n    <script type="text/montage-serialization">{"scrollbars":{"prototype":"ui/scroll-bars.reel","properties":{"element":{"#":"scrollbars"}}},"translateComposer1":{"prototype":"ui/composer/translate-composer","properties":{"component":{"@":"owner"},"minTranslateX":0,"minTranslateY":0,"invertAxis":true},"bindings":{"translateX":{"<->":"@owner.scrollX"},"translateY":{"<->":"@owner.scrollY"},"maxTranslateX":{"<-":"@owner._maxTranslateX"},"maxTranslateY":{"<-":"@owner._maxTranslateY"},"axis":{"<-":"@owner.axis"},"hasMomentum":{"<-":"@owner.hasMomentum"}},"listeners":[{"type":"translateStart","listener":{"@":"owner"}},{"type":"translateEnd","listener":{"@":"owner"}}]},"slot":{"prototype":"ui/slot.reel","properties":{"element":{"#":"content"}},"bindings":{"domContent":{"<-":"@owner.domContent"}}},"owner":{"prototype":"ui/scroller.reel","properties":{"_content":{"#":"content"},"element":{"#":"montage-scroller"},"_scrollBars":{"@":"scrollbars"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=montage-scroller class=montage-Scroller>\n        <div data-montage-id=scrollbars></div>\n        <div data-montage-id=content class=montage-Scroller-content></div>\n    </div>\n</body>\n</html>'}),montageDefine("120b0c7","ui/slot.reel/slot",{dependencies:["montage","ui/component"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component;t.Slot=r.create(i,{hasTemplate:{enumerable:!1,value:!1},didCreate:{value:function(){this.content=null}},delegate:{value:null},_content:{value:null},prepareForDraw:{value:function(){this.element.classList.add("montage-Slot")}},content:{get:function(){return this._content},set:function(e){var t;e&&typeof e.needsDraw!="undefined"?(e.element?t=e.element:(t=document.createElement("div"),t.id="appendDiv",this.delegate&&typeof this.delegate.slotElementForComponent=="function"&&(t=this.delegate.slotElementForComponent(this,e,t))),Object.getPropertyDescriptor(i,"domContent").set.call(this,t),e.setElementWithParentComponent(t,this),e.needsDraw=!0):Object.getPropertyDescriptor(i,"domContent").set.call(this,e),this._content=e,this.needsDraw=!0}},contentDidChange:{value:function(e,t){this.delegate&&typeof this.delegate.slotDidSwitchContent=="function"&&this.delegate.slotDidSwitchContent(this,e,e?e.controller:null,t,t?t.controller:null)}}})}}),montageDefine("120b0c7","ui/scroll-bars.reel/scroll-bars.html",{text:'<!DOCTYPE html>\n\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=scroll-bars.css>\n    <script type="text/montage-serialization">{"owner":{"properties":{"element":{"#":"montage-scroll-bars"},"_top":{"#":"top"},"_bottomClip":{"#":"bottom-clip"},"_bottom":{"#":"bottom"},"_left":{"#":"left"},"_rightClip":{"#":"right-clip"},"_right":{"#":"right"}}}}</script>\n</head>\n<body>\n    <div data-montage-id=montage-scroll-bars class=montage-ScrollBars>\n        <div data-montage-id=top class=montage-ScrollBars-top></div>\n        <div data-montage-id=bottom-clip class=montage-ScrollBars-bottomClip>\n            <div data-montage-id=bottom class=montage-ScrollBars-bottom></div>\n        </div>\n        <div data-montage-id=left class=montage-ScrollBars-left></div>\n        <div data-montage-id=right-clip class=montage-ScrollBars-rightClip>\n            <div data-montage-id=right class=montage-ScrollBars-right></div>\n        </div>\n    </div>\n</body>\n</html>'}),montageDefine("120b0c7","ui/input-range.reel/input-range.html",{text:'<!DOCTYPE html>\n\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=input-range.css>\n    <script type="text/montage-serialization">{"translateComposer1":{"prototype":"ui/composer/translate-composer","properties":{"component":{"@":"owner"},"axis":"horizontal","hasMomentum":false}},"owner":{"properties":{"element":{"#":"inputRange"},"_handleEl":{"#":"inputRangeThumb"},"_translateComposer":{"@":"translateComposer1"}}}}</script>\n</head>\n<body>\n    \n    <div data-montage-id=inputRange class=montage-InputRange>\n        <div data-montage-id=inputRangeThumb draggable=true class=montage-InputRange-thumb></div>\n    </div>\n</body>\n</html>'}),montageDefine("120b0c7","ui/substitution.reel/substitution",{dependencies:["montage","ui/component","ui/slot.reel","core/logger"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/slot.reel").Slot,o=e("core/logger").logger("substitution");t.Substitution=r.create(s,{hasTemplate:{enumerable:!1,value:!1},switchComponents:{distinct:!0,value:{}},_switchValue:{value:null},switchValue:{get:function(){return this._switchValue},set:function(e){if(this._switchValue===e||this._isSwitchingContent)return;this._switchValue=e,this.switchComponents&&(this.content=this.switchComponents[this.switchValue])}},transition:{value:null}})}}),montageDefine("120b0c7","ui/controller/object-controller",{dependencies:["montage"],factory:function(e,t,n){var r=e("montage").Montage,i=t.ObjectController=r.create(r,{objectPrototype:{enumerable:!1,value:null},newObject:{enumerable:!1,value:function(){return this.objectPrototype.create()}},initWithContent:{value:function(e){return this.content=e,this}},content:{enumerable:!1,value:null},blueprintModuleId:e("montage")._blueprintModuleIdDescriptor,blueprint:e("montage")._blueprintDescriptor})}}),montageDefine("a005228","core/effect/sepia-effect",{dependencies:["montage","core/effect/effect"],factory:function(e,t,n){var r=e("montage").Montage,i=e("core/effect/effect").Effect;t.SepiaEffect=r.create(i,{applyEffect:{value:function(e,t){var n=0,r;for(n=0;n<t;n+=4)r=(e[n]+e[n+1]+e[n+2])/3,e[n]=r+10,e[n+1]=r,e[n+2]=r}}})}}),montageDefine("a005228","core/effect/multiply-effect",{dependencies:["montage","core/effect/effect"],factory:function(e,t,n){var r=e("montage").Montage,i=e("core/effect/effect").Effect;t.MultiplyEffect=r.create(i,{applyEffect:{value:function(e,t,n){var r=0;for(r=0;r<t;r+=4)e[r]=e[r]*n,e[r+1]=e[r+1]*n,e[r+2]=e[r+2]*n}}})}}),montageDefine("120b0c7","ui/native/input-text.reel/input-text",{dependencies:["montage","ui/component","ui/text-input"],factory:function(e,t,n){var r=e("montage").Montage,i=e("ui/component").Component,s=e("ui/text-input").TextInput,o=t.InputText=r.create(s,{select:{value:function(){this._element.select()}}})}}),montageDefine("120b0c7","ui/button.reel/button.html",{text:"<!DOCTYPE html>\n\n<html>\n<head>\n    <meta charset=utf-8>\n    <link rel=stylesheet href=button.css>\n</head>\n<body>\n</body>\n</html>"}),montageDefine("a005228","core/effect/effect",{dependencies:["montage"],factory:function(e,t,n){var r=e("montage").Montage,i=t.Effect=r.create(r,{applyEffect:{enumerable:!1,value:null}})}})
bundleLoaded(undefined)