var Montage=require("montage").Montage,Component=require("montage/ui/component").Component;exports.PhotoInfoPanel=Montage.create(Component,{_photo:{value:null},photo:{get:function(){return this._photo},set:function(e){if(e===this._photo)return;this._photo=e,this._photoChanged=!0,this.needsDraw=!0}},_dragProxy:{value:null},_canvas:{value:null},_modifiedCanvas:{value:null},handleImagemodified:{value:function(e){this._modifiedCanvas=e.detail.editor._canvas,this.needsDraw=!0}},prepareForDraw:{value:function(){this.element.addEventListener("mouseover",this,!1),document.application.addEventListener("imagemodified",this,!1)}},handleMouseover:{value:function(){this.photo&&this._prepareDownload()}},willDraw:{value:function(){this._modifiedCanvas&&(this._canvasWidth=this._modifiedCanvas.offsetWidth,this._canvasHeight=this._modifiedCanvas.offsetHeight)}},_prepareDownload:{value:function(){this._dragProxy.setAttribute("src",this._canvas.toDataURL())}},draw:{value:function(){if(this._modifiedCanvas){var e=this._modifiedCanvas.getContext("2d"),t=e.getImageData(0,0,this._canvasWidth,this._canvasHeight);this._canvas.width=this._canvasWidth,this._canvas.height=this._canvasHeight;var n=this._canvas.getContext("2d");n.putImageData(t,0,0),this._modifiedCanvas=null}this._photoChanged&&(this.photo?this._dragProxy.setAttribute("alt",this.photo.title):this._dragProxy.removeAttribute("src"),this._photoChanged=!1)}}})