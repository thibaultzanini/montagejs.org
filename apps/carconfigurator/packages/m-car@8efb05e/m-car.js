var Montage=require("montage").Montage,CarModel=require("vehicle-config/core/car-model").CarModel;Color=require("vehicle-config/core/color").Color,Wheelset=require("vehicle-config/core/wheelset").Wheelset,Interior=require("vehicle-config/core/interior").Interior,BooleanConfigurationOption=require("vehicle-config/core/configuration-option").BooleanConfigurationOption,TridionBodyColorConverter=require("tridion-body-color-converter").TridionBodyColorConverter;var MontageCar=exports.MontageCar=Montage.create(CarModel,{moduleName:{value:"m-car"},modelPath:{value:"m-car/model/mcar.json"},baseURL:{value:require.location},manufacturer:{value:"Montage"},model:{value:"Pint"},year:{value:"2012"},description:{value:"The pure coupe is everything you need and nothing you don’t – it’s mcar in its purest form. You get the best of both worlds: 5-speed smartshift® transmission with automatic mode (for ease) and manual mode (for fun), hill start assist, and it’s packed with lots of standard safety features such as 8 full-size airbags. It’s driving fun with the perfect canvas to personalize. And, if all that's not enough, mcar has the best MPG of any gas vehicle based on Consumer Reports* testing."},options:{distinct:!0,value:{bodyColor:[Color.create().initWithNameAndCostAndRGB("Deep Black",0,45,54,58),Color.create().initWithNameAndCostAndRGB("Crystal White",0,255,255,255),Color.create().initWithNameAndCostAndRGB("Rally Red",0,231,33,33),Color.create().initWithNameAndCostAndRGB("Gray Metallic",250,126,116,102),Color.create().initWithNameAndCostAndRGB("Light Blue Metallic",250,134,156,185)],tridionColor:[Color.create().initWithNameAndCostAndRGB("Silver",0,174,177,178),Color.create().initWithNameAndCostAndRGB("Black",0,0,0,0)],wheelset:[Wheelset.create().initWithNameAndCost("Silver"),Wheelset.create().initWithNameAndCost("Black")],interior:[Color.create().initWithNameAndCostAndRGB("Design Black",0,16,15,25),Color.create().initWithNameAndCostAndRGB("Design Red",0,124,30,5),Color.create().initWithNameAndCostAndRGB("Design Beige",0,174,161,124),Color.create().initWithNameAndCostAndRGB("Black Leather Seating",0,84,90,108),Color.create().initWithNameAndCostAndRGB("Crystal Grey Leather",1300,161,161,161)],interiorOptions:[BooleanConfigurationOption.create().initWithNameAndCost("Dashboard Gauges",120),BooleanConfigurationOption.create().initWithNameAndCost("Heated Seats",240),BooleanConfigurationOption.create().initWithNameAndCost("Luggage Compartment Cover",99),BooleanConfigurationOption.create().initWithNameAndCost("Ambient light for interior",190),BooleanConfigurationOption.create().initWithNameAndCost("Center console storage",30)]}},_bodyColor:{value:null},bodyColor:{get:function(){return this._bodyColor},set:function(e){if(e===this._bodyColor)return;this._bodyColor=e,this.performConfigurationChange("bodyColor")}},customBodyColor:{value:null},_tridionColor:{value:null},tridionColor:{get:function(){return this._tridionColor},set:function(e){if(e===this._tridionColor)return;this._tridionColor=e,this.performConfigurationChange("tridionColor")}},bodyColorTridionColor:{value:null},_wheelset:{value:null},wheelset:{get:function(){return this._wheelset},set:function(e){if(e===this._wheelset)return;this._wheelset=e,this.performConfigurationChange("wheelset")}},_interior:{value:null},interior:{get:function(){return this._interior},set:function(e){if(e===this._interior)return;this._interior=e,this.performConfigurationChange("interior")}},_licensePlateValue:{value:"fortwo"},licensePlateValue:{get:function(){return this._licensePlateValue},set:function(e){if(e===this._licensePlateValue)return;this._licensePlateValue=e,this.performConfigurationChange("licensePlateValue")}},interiorOptions:{dependencies:["options.interiorOptions.chosen"],get:function(){return this.options.interiorOptions.filter(function(e){return e.chosen})}},basePrice:{value:14890},didCreate:{value:function(){this.wheelset=this.options.wheelset[0],this.interior=this.options.interior[0],this.customBodyColor=Color.create().initWithNameAndCostAndRGB("Custom",1500,254,203,66),this.options.bodyColor.push(this.customBodyColor),this.bodyColor=this.customBodyColor,this.customBodyColor.addPropertyChangeListener("red",this),this.customBodyColor.addPropertyChangeListener("green",this),this.customBodyColor.addPropertyChangeListener("blue",this);var e=this.bodyColorTridionColor=Color.create().initWithNameAndCostAndRGB("Body Color",1500),t=TridionBodyColorConverter.create();Object.defineBinding(e,"red",{boundObject:this,boundObjectPropertyPath:"bodyColor.red",oneway:!0,converter:t}),Object.defineBinding(e,"green",{boundObject:this,boundObjectPropertyPath:"bodyColor.green",oneway:!0,converter:t}),Object.defineBinding(e,"blue",{boundObject:this,boundObjectPropertyPath:"bodyColor.blue",oneway:!0,converter:t}),this.options.tridionColor.push(e),this.tridionColor=e,e.addPropertyChangeListener("red",this),e.addPropertyChangeListener("green",this),e.addPropertyChangeListener("blue",this),this.addPropertyChangeListener("options.interiorOptions.chosen",this),this.fromHash(),CarModel.didCreate.call(this)}},initializeModelRepresentation:{value:function(){this.configureModel("bodyColor"),this.configureModel("tridionColor"),this.configureModel("interior"),this.configureModel("wheelset"),this.configureModel("licensePlateValue");var e,t,n=["material_5","black"];for(var r=0;r<n.length;r++)e=n[r],t=this.modelRepresentation.materialForName(e),t&&(t.inputs.shininess=50);var i=["material_15","material_4"];for(var r=0;r<i.length;r++)e=i[r],t=this.modelRepresentation.materialForName(e),t&&(t.inputs.shininess=1e3)}},_highlightTimeouts:{distinct:!0,value:{}},highlightDuration:{value:400},highlightModel:{value:function(e,t){this.modelRepresentation.implicitAnimationsEnabled=!1,clearTimeout(this._highlightTimeouts[e]);var n=this.modelRepresentation.materialForName(t);n.inputs.diffuseColor=[.8,.8,.8],this.modelRepresentation.update();var r=this;this._highlightTimeouts=setTimeout(function(){r.unhighlightModel(e,t)},this.highlightDuration)}},unhighlightModel:{value:function(e,t){this.configureModel(e,!1)}},configureModel:{value:function(e,t){if(!this.modelRepresentation||!this.modelRepresentation.hasMaterials)return;clearTimeout(this._highlightTimeouts[e]),this.modelRepresentation.implicitAnimationsEnabled=t||typeof t=="undefined";var n,r,i;if("bodyColor"===e)return n=this.bodyColor,r="material_14",i=this.modelRepresentation.materialForName(r),i.inputs.diffuseColor=[n.red/255,n.green/255,n.blue/255],this.modelRepresentation.update(),!0;if("tridionColor"===e)return n=this.tridionColor,r="material_5",i=this.modelRepresentation.materialForName(r),i.inputs.diffuseColor=[n.red/255,n.green/255,n.blue/255],this.modelRepresentation.update(),!0;if("interior"===e)return n=this.interior,r="interior1",i=this.modelRepresentation.materialForName(r),i.inputs.diffuseColor=[n.red/255,n.green/255,n.blue/255],this.modelRepresentation.update(),!0;if("wheelset"===e)return!0;if("licensePlateValue"===e)return!0}},handleChange:{value:function(e){var t=e.currentPropertyPath;/tridionColor|bodyColor|red|green|blue/.test(t)?(this.configureModel("bodyColor"),this.configureModel("tridionColor")):/interiorOptions/.test(t)&&this.configureModel("interiorOptions")}},toHash:{value:function(){window.mcar=this;var e="#!bodyColor/"+this.options.bodyColor.indexOf(this.bodyColor);e+="/customBodyColor/"+this.customBodyColor.hex,e+="/tridionColor/"+this.options.tridionColor.indexOf(this.tridionColor),e+="/wheelset/"+this.options.wheelset.indexOf(this.wheelset),e+="/interior/"+this.options.interior.indexOf(this.interior),e+="/plate/"+this.licensePlateValue;var t=this.options.interiorOptions.map(function(e,t){return e.chosen?t:null}).filter(function(e){return null!=e});return e+="/interiorOptions/"+t.join(","),e}},fromHash:{value:function(){var e=window.location.hash,t;if(!/#!/.test(e))return;e=decodeURIComponent(e),e=e.replace(/#!/,""),t=e.match(/bodyColor\/(\d+)/),null!=t&&null!=t[1]&&(this.bodyColor=this.options.bodyColor[t[1]]),t=e.match(/customBodyColor\/(#[\w\d]{6})/),null!=t&&null!=t[1]&&(this.customBodyColor.hex=t[1]),t=e.match(/tridionColor\/(\d+)/),null!=t&&null!=t[1]&&(this.tridionColor=this.options.tridionColor[t[1]]),t=e.match(/wheelset\/(\d+)/),null!=t&&null!=t[1]&&(this.wheelset=this.options.wheelset[t[1]]),t=e.match(/interior\/(\d+)/),null!=t&&null!=t[1]&&(this.interior=this.options.interior[t[1]]),t=e.match(/plate\/([\w\s\d]+)/),null!=t&&null!=t[1]&&(this.licensePlateValue=t[1]),t=e.match(/interiorOptions\/((\d,?)*)/);if(null!=t&&null!=t[1]){var n=t[1].split(",").map(function(e){return parseInt(e,10)});this.options.interiorOptions.forEach(function(e,t){e.chosen=n.indexOf(t)>=0})}}}})