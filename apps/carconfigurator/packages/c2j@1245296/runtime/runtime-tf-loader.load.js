montageDefine("1245296","runtime/runtime-tf-loader",{dependencies:["runtime/dependencies/gl-matrix","webgl-tf-loader","runtime/resource-description","runtime/technique","runtime/pass","runtime/glsl-program","runtime/material","runtime/mesh","runtime/node","runtime/primitive","runtime/projection","runtime/camera","runtime/scene"],factory:function(e,t,n){e("runtime/dependencies/gl-matrix");var r=e("webgl-tf-loader").WebGLTFLoader,i=e("runtime/resource-description").ResourceDescription,s=e("runtime/technique").Technique,o=e("runtime/pass").Pass,u=e("runtime/glsl-program").GLSLProgram,a=e("runtime/material").Material,f=e("runtime/mesh").Mesh,l=e("runtime/node").Node,c=e("runtime/primitive").Primitive,h=e("runtime/projection").Projection,p=e("runtime/camera").Camera,d=e("runtime/scene").Scene;t.RuntimeTFLoader=Object.create(r,{_scenes:{writable:!0,value:null},handleBuffer:{value:function(e,t,n){var r=Object.create(i).init(e,t);return r.id=e,this.storeEntry(e,r,t),!0}},handleShader:{value:function(e,t,n){var r=Object.create(i).init(e,t);return r.id=e,r.type="shader",this.storeEntry(e,r,t),!0}},handleTechnique:{value:function(e,t,n){var r=Object.create(s);r.id=e,this.storeEntry(e,r,t),r.rootPass=Object.create(o).init(),r.rootPass.id=e+"_"+a;var a=t.pass,f=t[a],l=this.getEntry(f[u.VERTEX_SHADER]),c=this.getEntry(f[u.FRAGMENT_SHADER]),h={};return h[u.VERTEX_SHADER]=l.entry,h[u.FRAGMENT_SHADER]=c.entry,r.rootPass.program=Object.create(i).init(e+"_"+a+"_program",h),r.rootPass.program.type="program",r.rootPass.states=f.states,!0}},handleMaterial:{value:function(e,t,n){a.loader=this;var r=Object.create(a).init(e);this.storeEntry(e,r,t),t.inputs.diffuseTexture&&(t.inputs.diffuseTexture=this.resolvePathIfNeeded(t.inputs.diffuseTexture)),r.inputs=t.inputs,r.name=t.name;var i=this.getEntry(t.technique);return i?(r.technique=i.entry,!0):(console.log("ERROR: invalid file, cannot find referenced technique:"+t.technique),!1)}},handleLight:{value:function(e,t,n){return!0}},handleMesh:{value:function(e,t,n){var r=Object.create(f).init();r.id=e,r.name=t.name,this.storeEntry(e,r,t);var i=t[f.PRIMITIVES];if(!i)return console.log("MISSING_PRIMITIVES for mesh:"+e),!1;for(var s=0;s<i.length;s++){var o=i[s];if(o.primitive==="TRIANGLES"){var u=Object.create(c).init(),a=this.getEntry(o.material);u.material=a.entry,u.mesh=r,r.primitives.push(u);var l=o.vertexAttributes;l.forEach(function(e){var n=e.accessor,r=this.getEntry(n);if(!r){var i=t[n];i.id=n,this.storeEntry(n,i,i);var s=this.getEntry(i.buffer);i.buffer=s.entry,r=this.getEntry(n)}var o=e.set?e.set:"0";u.addVertexAttribute({semantic:e.semantic,set:o,accessor:r.entry})},this);var h=e+"_indices"+"_"+s,p=this.getEntry(h);if(!p){indices=o.indices,indices.id=h;var d=this.getEntry(indices.buffer);indices.buffer=d.entry,this.storeEntry(h,indices,indices),p=this.getEntry(h)}u.indices=p.entry}}return!0}},handleCamera:{value:function(e,t,n){var r=Object.create(p).init();r.id=e,this.storeEntry(e,r,t);var i=Object.create(h);return i.initWithDescription(t),r.projection=i,!0}},handleLight:{value:function(e,t,n){return!0}},buildNodeHirerachy:{value:function(e){var t=e.entry,n=e.description.children;n&&n.forEach(function(e){var n=this.getEntry(e);t.children.push(n.entry),this.buildNodeHirerachy(n)},this)}},handleScene:{value:function(e,t,n){this._scenes||(this._scenes=[]);if(!t.node)return console.log("ERROR: invalid file required node property is missing from scene"),!1;var r=Object.create(d).init();r.id=e,r.name=t.name,this.storeEntry(e,r,t);var i=this.getEntry(t.node);return r.rootNode=i.entry,this._scenes.push(r),this.buildNodeHirerachy(i),!0}},handleNode:{value:function(e,t,n){var r=0,i=this,s=Object.create(l).init();s.id=e,s.name=t.name,this.storeEntry(e,s,t),s.transform=t.matrix?mat4.create(t.matrix):mat4.identity();var o;t.mesh&&(o=this.getEntry(t.mesh),s.meshes.push(o.entry)),t.meshes&&t.meshes.forEach(function(e){o=this.getEntry(e),s.meshes.push(o.entry)},this);if(t.camera){var u=this.getEntry(t.camera);s.cameras.push(u.entry)}return!0}},handleLoadCompleted:{value:function(e){this._scenes&&this.delegate&&this._scenes.length>0&&this.delegate.loadCompleted(this._scenes[0])}},handleError:{value:function(e){}},_delegate:{value:null,writable:!0},delegate:{enumerable:!0,get:function(){return this._delegate},set:function(e){this._delegate=e}},_entries:{enumerable:!1,value:null,writable:!0},removeAllEntries:{value:function(){this._entries={}}},containsEntry:{enumerable:!1,value:function(e){return this._entries?this._entries[e]?!0:!1:!1}},storeEntry:{enumerable:!1,value:function(e,t,n){this._entries||(this._entries={});if(!e){console.log("ERROR: not id provided, cannot store");return}this.containsEntry[e]&&console.log("WARNING: entry:"+e+" is already stored, overriding"),this._entries[e]={id:e,entry:t,description:n}}},getEntry:{enumerable:!1,value:function(e){return this._entries?this._entries[e]:null}}})}})