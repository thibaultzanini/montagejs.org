require("runtime/dependencies/gl-matrix"),exports.Utilities=Object.create(Object.prototype,{vec3Min:{value:function(e,t){t[0]<e[0]&&(e[0]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[2]<e[2]&&(e[2]=t[2])}},vec4Max:{value:function(e,t){t[0]>e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1]),t[2]>e[2]&&(e[2]=t[2])}},mergeBBox:{value:function(e,t){var n=e[0],r=e[1],i=t[0],s=t[1],o=[n[0]<i[0]?n[0]:i[0],n[1]<i[1]?n[1]:i[1],n[2]<i[2]?n[2]:i[2]],u=[r[0]>s[0]?r[0]:s[0],r[1]>s[1]?r[1]:s[1],r[2]>s[2]?r[2]:s[2]];return[o,u]}},computeBBOXFromVec3Array:{value:function(e){if(e.length===0)return null;var t=[e[0][0],e[0][1],e[0][2]],n=[e[0][0],e[0][1],e[0][2]];for(var r=0;r<8;r++)e[r][0]<t[0]&&(t[0]=e[r][0]),e[r][1]<t[1]&&(t[1]=e[r][1]),e[r][2]<t[2]&&(t[2]=e[r][2]),e[r][0]>n[0]&&(n[0]=e[r][0]),e[r][1]>n[1]&&(n[1]=e[r][1]),e[r][2]>n[2]&&(n[2]=e[r][2]);return[t,n]}},transformBBox:{value:function(e,t){var n=e[0],r=e[1],i=0,s=1,o=2,u=mat4.multiplyVec3(t,vec3.createFrom(n[i],n[s],n[o])),a=mat4.multiplyVec3(t,vec3.createFrom(r[i],n[s],n[o])),f=mat4.multiplyVec3(t,vec3.createFrom(n[i],r[s],n[o])),l=mat4.multiplyVec3(t,vec3.createFrom(r[i],r[s],n[o])),c=mat4.multiplyVec3(t,vec3.createFrom(n[i],n[s],r[o])),h=mat4.multiplyVec3(t,vec3.createFrom(r[i],n[s],r[o])),p=mat4.multiplyVec3(t,vec3.createFrom(n[i],r[s],r[o])),d=mat4.multiplyVec3(t,vec3.createFrom(r[i],r[s],r[o]));return this.computeBBOXFromVec3Array([u,a,f,l,c,h,p,d])}},rayIntersectsTriangle:{value:function(e,t,n,r){var i=vec3.create(),s=vec3.create(),o=vec3.create(),u=1e-6,a=e[0],f=e[1],l,c;vec3.subtract(n,t,i),vec3.subtract(r,t,s),vec3.cross(f,s,o),l=vec3.dot(i,o);if(l>-u&&l<u)return null;var h=vec3.create();c=1/l,vec3.subtract(a,t,h);var p=vec3.dot(h,o)*c;if(p<0||p>1)return null;var d=vec3.create();vec3.cross(h,i,d);var v=vec3.dot(f,d)*c;if(v<0||p+v>1)return null;var m=vec3.dot(s,d)*c,g=vec3.create();return g[0]=a[0]+f[0]*m,g[1]=a[1]+f[1]*m,g[2]=a[2]+f[2]*m,g}},rayIntersectsMesh:{value:function(e,t,n,r,i){var s=t.verticesBuffer;if(s===null)return!1;var o=!1,u=t.primitives.length,a=vec3.create(),f=vec3.create(),l=vec3.create();for(var c=0;c<u;c++){var h=t.primitives[c];if(t.hidden)continue;if(i){var p=i.materials;if(p&&p.indexOf(h.material["name"])==-1)continue}var d=h.indicesBuffer;if(!d)continue;if(h.material.inputs.transparency!==null&&typeof h.material.inputs.transparency!="undefined"&&h.material.inputs.transparency<1)continue;var v=h.boundingBox;if(!this.intersectsBBOX(v,e))continue;for(var m=0;m<d.length;m+=3){var g=d[m]*3,y=d[m+1]*3,b=d[m+2]*3;a[0]=s[g],a[1]=s[g+1],a[2]=s[g+2],f[0]=s[y],f[1]=s[y+1],f[2]=s[y+2],l[0]=s[b],l[1]=s[b+1],l[2]=s[b+2];var w=this.rayIntersectsTriangle(e,a,f,l);if(w){mat4.multiplyVec3(n,a),mat4.multiplyVec3(n,f),mat4.multiplyVec3(n,l);var E=vec3.create(),S=vec3.create(),x=vec3.create();vec3.subtract(f,a,E),vec3.subtract(l,a,S),vec3.cross(E,S,x),x[2]>0&&(mat4.multiplyVec3(n,w),r.push({intersection:w,material:h.material,mesh:t}),o=!0)}}}return o}},intersectsBBOX:{value:function(e,t){var n=0,r=1,i=2,s,o,u,a,f,l,c=t[1],h=t[0],p=e[0],d=e[1];return c[n]>=0?(s=(p[n]-h[n])/c[n],o=(d[n]-h[n])/c[n]):(s=(d[n]-h[n])/c[n],o=(p[n]-h[n])/c[n]),c[r]>=0?(u=(p[r]-h[r])/c[r],a=(d[r]-h[r])/c[r]):(u=(d[r]-h[r])/c[r],a=(p[r]-h[r])/c[r]),s>a||u>o?!1:(u>s&&(s=u),a<o&&(o=a),c[i]>=0?(f=(p[i]-h[i])/c[i],l=(d[i]-h[i])/c[i]):(f=(d[i]-h[i])/c[i],l=(p[i]-h[i])/c[i]),s>l||f>o?!1:(f>s&&(s=f),l<o&&(o=l),!0))}}})