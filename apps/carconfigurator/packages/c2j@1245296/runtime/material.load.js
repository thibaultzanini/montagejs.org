montageDefine("1245296","runtime/material",{dependencies:["runtime/dependencies/gl-matrix","runtime/base","runtime/technique","runtime/pass","runtime/glsl-program","runtime/resource-description","montage/core/uuid","montage"],factory:function(e,t,n){e("runtime/dependencies/gl-matrix");var r=e("runtime/base").Base,i=e("runtime/technique").Technique,s=e("runtime/pass").Pass,o=e("runtime/glsl-program").GLSLProgram,u=e("runtime/resource-description").ResourceDescription,a=e("montage/core/uuid").Uuid,f=e("montage").Montage,l=f.create(f,{_path:{value:null,writable:!0},_type:{value:null,writable:!0},_startValue:{value:null,writable:!0},_savedStart:{value:null,writable:!0},_endValue:{value:null,writable:!0},_context:{value:null,writable:!0},_delegate:{value:null,writable:!0},_duration:{value:0,writable:!0},_startTime:{value:0,writable:!0},_intervalRequest:{value:0,writable:!0},_interpolatedValue:{value:null,writable:!0},init:{value:function(e,t,n,r,i,s,o){this._type=t,this._startValue=n,this._endValue=r,this._context=s,this._delegate=o,this._duration=i,this._path=e,this._startValue=vec3.create(),t==="vec3"?(this._savedStart=[n[0],n[1],n[2]],this._interpolatedValue=n):t==="vec4"?(this._savedStart=[n[0],n[1],n[2],n[3]],this._interpolatedValue=n):t==="float"&&(this._interpolatedValue=n)}},handleUpdate:{value:function(){var e=new Date,t=e.getTime()/1e3,n=(t-this._startTime)/this._duration;if(this._delegate){var r=this._interpolatedValue;this._type==="vec3"?(r[0]=(1-n)*this._savedStart[0]+n*this._endValue[0],r[1]=(1-n)*this._savedStart[1]+n*this._endValue[1],r[2]=(1-n)*this._savedStart[2]+n*this._endValue[2]):this._type==="vec4"?(r[0]=(1-n)*this._savedStart[0]+n*this._endValue[0],r[1]=(1-n)*this._savedStart[1]+n*this._endValue[1],r[2]=(1-n)*this._savedStart[2]+n*this._endValue[2],r[3]=(1-n)*this._savedStart[3]+n*this._endValue[3]):this._type==="float"&&(this._interpolatedValue=(1-n)*this._savedStart+n*this._endValue);if(n<1){var i=this;requestAnimationFrame(function(){i.handleUpdate.call(i)})}this._delegate&&this._delegate.handleAnimationValueUpdate&&this._delegate.handleAnimationValueUpdate(this,this._path,r)}}},stopAnimation:{value:function(){}},run:{value:function(){window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60,new Date)}}();var e=new Date,t=e.getTime()/1e3,n=this;this._startTime=t,this.handleUpdate()}}});t.Material=Object.create(r,{implicitAnimationsEnabled:{value:!1,writable:!0},animationDuration:{value:.7,writable:!1},animationDelegate:{value:null,writable:!0},_loader:{value:null,writable:!0},loader:{enumerable:!1,get:function(){return this._loader},set:function(e){this._loader=e}},_materialForID:{value:{},writable:!0},materialForID:{enumerable:!1,get:function(){return this._materialForID},set:function(e){this._materialForID=e}},_techniqueForID:{value:{},writable:!0},inputWillChange:{value:function(e,t){if(!this.technique)return;var n=null;if(this.technique)if(t===null||this.inputs[e]!==null&&typeof this.inputs[e]!="undefined"){if(t!==null)return;e==="reflectionTexture"&&(this.inputs.diffuseColor?this.inputs.transparency?n="lambert2":n="lambert0":this.inputs.diffuseTexture&&(this.inputs.transparency?n="lambert3":n="lambert1"))}else e==="diffuseColor"?(this.inputs.diffuseTexture&&delete this.inputs.diffuseTexture,this.inputs.transparency?n="lambert2":n="lambert0"):e==="diffuseTexture"?(this.inputs.diffuseColor&&delete this.inputs.diffuseColor,this.inputs.transparency?n="lambert3":n="lambert1"):e==="transparency"?this.inputs.diffuseColor?n="lambert2":n="lambert3":e==="reflectionTexture"&&(this.inputs.diffuseColor?this.inputs.transparency?n="lambert6":n="lambert4":this.inputs.transparency?n="lambert7":n="lambert5");if(n){var r=this._techniqueForID[n];if(r===this.technique)return;var a=this.technique,f=[];if(a){var l=a.rootPass,c=[];l.primitives.forEach(function(e){e.primitive.material===this?f.push(e):c.push(e)},this),a.rootPass.primitives=c}if(!r){r=Object.create(i).init(),r.rootPass=Object.create(s).init(),r.rootPass.id=n,a&&a.rootPass.parentPass.addPass(r.rootPass);var h=this.loader.resolvePathIfNeeded(n+"Vs.glsl"),p=this.loader.resolvePathIfNeeded(n+"Fs.glsl"),d=Object.create(u).init("__shadervs_"+n,{path:h,type:"shader"});d.type="shader";var v=Object.create(u).init("__shaderfs_"+n,{path:p,type:"shader"});v.type="shader";var m={};m[o.VERTEX_SHADER]=d,m[o.FRAGMENT_SHADER]=v,r.rootPass.program=Object.create(u).init("__program"+n,m),r.rootPass.program.type="program",n==="lambert2"||n==="lambert3"||n==="lambert6"||n==="lambert7"?r.rootPass.states={BLEND:!0}:r.rootPass.states={BLEND:!1},this._techniqueForID[n]=r}f.forEach(function(e){r.rootPass.primitives.push(e)},this),this.technique=r}}},inputDidChange:{value:function(e){}},handleAnimationValueUpdate:{value:function(e,t,n){this.inputs["_"+t]=n,this.animationDelegate&&this.animationDelegate.handleAnimationValueUpdate()}},_addInputPropertyIfNeeded:{value:function(e){var t="_"+e,n=this;this.inputs.hasOwnProperty(e)===!1&&(Object.defineProperty(this.inputs,t,{writable:!0,value:null}),Object.defineProperty(this.inputs,e,{get:function(){return n.inputs[t]},set:function(r){var i=n.inputs[e];n.inputWillChange.call(n,e,r);if(e==="diffuseTexture"||e==="reflectionTexture"){if(typeof r=="string"){var s=r,o=Object.create(u).init(s,{path:s});o.type="image",r=o}else if(r!==null){var c=r,h=c.__uuid;if(!h){var p=c.src;p?h=p.split("/").join("_"):h=a.generate(),c.__uuid=h}var o=Object.create(u).init(h,{image:c});o.type="image",r=o}}else if(n.implicitAnimationsEnabled&&e==="diffuseColor"&&i!==null&&i!=="undefined"){var d=f.create(l);d.init(e,"vec3",i,r,n.animationDuration,this,n),d.run()}else if(n.implicitAnimationsEnabled&&e==="transparency"&&i!==null&&i!=="undefined"){var d=f.create(l);d.init(e,"float",i,r,n.animationDuration,this,n),d.run()}else n.inputs[t]=r;n.inputDidChange.call(n,e)}}))}},_prepareInputsProperties:{value:function(){var e=["diffuseColor","diffuseTexture","transparency","reflectionTexture","reflectionIntensity","shininess","specularColor"];e.forEach(function(e){this._addInputPropertyIfNeeded(e)},this)}},_technique:{value:null,writable:!0},technique:{enumerable:!1,get:function(){return this._technique},set:function(e){this._technique=e}},_material:{value:null,writable:!0},material:{enumerable:!1,get:function(){return this._material},set:function(e){this._material=e}},_inputs:{value:null,writable:!0},inputs:{enumerable:!1,get:function(){return this._inputs},set:function(e){var t=Object.keys(e);t.forEach(function(t){this._inputs[t]=e[t]},this)}},init:{value:function(e){return this.id=e,this.__Base_init(),this._inputs={},this._prepareInputsProperties(),this.materialForID[e]=this,this}}})}})