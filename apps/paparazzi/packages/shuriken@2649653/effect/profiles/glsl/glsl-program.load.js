montageDefine("2649653","effect/profiles/glsl/glsl-program",{dependencies:["montage/core/core"],factory:function(e,t,n){var r=e("montage/core/core").Montage;GLSLProgram=t.GLSLProgram=r.create(r,{VERTEX_SHADER:{enumerable:!1,get:function(){return"x-shader/x-vertex"}},FRAGMENT_SHADER:{enumerable:!1,get:function(){return"x-shader/x-fragment"}},VERTEX:{enumerable:!1,get:function(){return"VERTEX"}},NORMAL:{enumerable:!1,get:function(){return"NORMAL"}},UV_0:{enumerable:!1,get:function(){return"UV_0"}},MODELVIEW_MATRIX:{enumerable:!1,get:function(){return"MODELVIEW_MATRIX"}},PROJECTION_MATRIX:{enumerable:!1,get:function(){return"PROJECTION_MATRIX"}},MODELVIEW_PROJECTION_MATRIX:{enumerable:!1,get:function(){return"MODELVIEW_PROJECTION_MATRIX"}},_shaders:{enumerable:!1,value:null},shaders:{enumerable:!1,get:function(){return this._shaders},set:function(e){this._shaders=e}},_errorLogs:{enumerable:!1,value:null},errorLogs:{enumerable:!1,get:function(){return this._errorLogs},set:function(e){this._errorLogs=e}},_pendingCommits:{enumerable:!1,value:null},pendingCommits:{enumerable:!1,get:function(){return this._pendingCommits},set:function(e){this._pendingCommits=e}},_symbolToLocation:{enumerable:!1,value:null},symbolToLocation:{enumerable:!1,get:function(){return this._symbolToLocation},set:function(e){this._symbolToLocation=e}},_symbolToActiveInfo:{enumerable:!1,value:null},symbolToActiveInfo:{enumerable:!1,get:function(){return this._symbolToActiveInfo},set:function(e){this._symbolToActiveInfo=e}},_semanticToSymbol:{enumerable:!1,value:null},semanticToSymbol:{enumerable:!1,get:function(){return this._semanticToSymbol},set:function(e){this._semanticToSymbol=e}},_symbolToSemantic:{enumerable:!1,value:null},symbolToSemantic:{enumerable:!1,get:function(){return this._symbolToSemantic},set:function(e){this._symbolToSemantic=e}},_symbolToValue:{enumerable:!1,value:null},symbolToValue:{enumerable:!1,get:function(){return this._symbolToValue},set:function(e){this._symbolToValue=e}},_uniformSymbols:{enumerable:!1,value:null},uniformSymbols:{enumerable:!1,get:function(){return this._uniformSymbols},set:function(e){this._uniformSymbols=e}},_attributeSymbols:{enumerable:!1,value:null},attributeSymbols:{enumerable:!1,get:function(){return this._attributeSymbols},set:function(e){this._attributeSymbols=e}},_GLProgram:{enumerable:!1,value:null},GLProgram:{enumerable:!1,get:function(){return this._GLProgram},set:function(e){this._GLProgram=e}},getTypeForSymbol:{value:function(e){var t=null,n=this.symbolToActiveInfo[e];return n&&(t=n.type),t}},getLocationForSymbol:{value:function(e){return this.symbolToLocation[e]}},getSymbolForSemantic:{value:function(e){return this.semanticToSymbol[e]}},setSymbolForSemantic:{value:function(e,t){e==="none"&&(e=null),t==="none"&&(t=null);if(!this.symbolToActiveInfo[e])return!1;if(t&&this.semanticToSymbol[t])return!1;if(e){var n=this.symbolToSemantic[e];n&&n!==t&&(this.semanticToSymbol[n]=null),this.symbolToSemantic[e]=t}return t&&(this.semanticToSymbol[t]=e),!0}},setSemanticForSymbol:{value:function(e,t){this.setSymbolForSemantic(e,t)}},getSemanticForSymbol:{value:function(e){return this.symbolToSemantic[e]}},setValueForSymbol:{value:function(e,t){this.symbolToActiveInfo[e]!==null&&this.pendingCommits.indexOf(e)===-1&&this.pendingCommits.push(e),this.symbolToValue[e]=t}},getValueForSymbol:{value:function(e){return this.symbolToValue[e]}},commit:{value:function(e){var t=0,n=this.pendingCommits.length;for(t=0;t<n;t++){var r=this.pendingCommits[t],i=this.getTypeForSymbol(r),s=e.getUniformLocation(this.GLProgram,r),o=this.getValueForSymbol(r);switch(i){case e.FLOAT_MAT2:e.uniformMatrix2fv(s,!1,o);break;case e.FLOAT_MAT3:e.uniformMatrix3fv(s,!1,o);break;case e.FLOAT_MAT4:e.uniformMatrix4fv(s,!1,o);break;case e.FLOAT:e.uniform1f(s,o);break;case e.FLOAT_VEC3:e.uniform3fv(s,o);break;case e.FLOAT_VEC4:e.uniform4fv(s,o)}}this.pendingCommits=[]}},use:{value:function(e){e.useProgram(this.GLProgram),this.commit(e)}},createShaderWithSourceAndType:{value:function(t,n,r){var i;if(r==="x-shader/x-fragment")i=t.createShader(t.FRAGMENT_SHADER);else{if(r!=="x-shader/x-vertex")return null;i=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(this.errorLogs=t.getShaderInfoLog(i),null)}},build:{value:function(e){var t,n=this.shaders["x-shader/x-vertex"],r=this.shaders["x-shader/x-fragment"],i=!1,s=this.createShaderWithSourceAndType(e,n,"x-shader/x-vertex");if(s===null)return!1;var o=this.createShaderWithSourceAndType(e,r,"x-shader/x-fragment");if(o===null)return!1;this.GLProgram=e.createProgram(),e.attachShader(this.GLProgram,s),e.attachShader(this.GLProgram,o),e.linkProgram(this.GLProgram);if(e.getProgramParameter(this.GLProgram,e.LINK_STATUS)){e.useProgram(this.GLProgram);var u=e.getProgramParameter(this.GLProgram,e.ACTIVE_UNIFORMS);for(t=0;t<u;t++){var a=e.getActiveUniform(this.GLProgram,t);this.symbolToActiveInfo[a.name]=a,this.symbolToLocation[a.name]=e.getUniformLocation(this.GLProgram,a.name),this.uniformSymbols.push(a.name)}var f=e.getProgramParameter(this.GLProgram,e.ACTIVE_ATTRIBUTES);for(t=0;t<f;t++){var a=e.getActiveAttrib(this.GLProgram,t);this.symbolToActiveInfo[a.name]=a,this.symbolToLocation[a.name]=e.getAttribLocation(this.GLProgram,a.name),this.attributeSymbols.push(a.name)}i=!0}return this.errorLogs=e.getProgramInfoLog(this.GLProgram),i}},_commonInit:{value:function(){this.pendingCommits=[],this.symbolToActiveInfo={},this.symbolToValue={},this.symbolToLocation={},this.uniformSymbols=[],this.attributeSymbols=[],this.symbolToSemantic={},this.semanticToSymbol={}}},initWithShaders:{value:function(e){this._commonInit(),this.shaders=e}},initWithProgram:{value:function(e){this._commonInit(),this.shaders=e.shaders,this.semanticToSymbol=e.semanticToSymbol,this.symbolToSemantic=e.symbolToSemantic}}})}})