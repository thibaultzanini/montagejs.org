var Montage=require("montage").Montage,Component=require("ui/component").Component;exports.Checkbox=Montage.create(Component,{touchMovementThreshold:{enumerable:!1,value:256},_nativeCheckbox:{enumerable:!1,value:null},_background:{enumerable:!1,value:null},_button:{enumerable:!1,value:null},_checkmark:{enumerable:!1,value:null},handleMousedown:{enumerable:!1,value:function(e){e.preventDefault(),this._disabled||this._acknowledgeIntent("mouse")}},handleMouseup:{value:function(e){this._interpretInteraction(e)}},_touchX:{enumerable:!1,value:null},_touchY:{enumerable:!1,value:null},handleTouchstart:{enumerable:!1,value:function(e){if(this._disabled||this._observedPointer!==null)return;e.preventDefault(),this._acknowledgeIntent(e.targetTouches[0].identifier),this._touchX=e.targetTouches[0].clientX,this._touchY=e.targetTouches[0].clientY}},handleTouchmove:{enumerable:!1,value:function(e){var t=0,n=e.touches.length,r,i;while(t<n&&e.touches[t].identifier!==this._observedPointer)t++;if(t<n){r=this._touchX-e.touches[t].clientX,i=this._touchY-e.touches[t].clientY;var s=r*r+i*i;s>this.touchMovementThreshold&&(e.preventDefault(),this._releaseInterest(),this.active=!1,this.needsDraw=!0)}}},handleTouchend:{enumerable:!1,value:function(e){var t=0,n=e.changedTouches.length;for(;t<n;t++)if(e.changedTouches[t].identifier===this._observedPointer){this._interpretInteraction(e);return}}},handleTouchcancel:{value:function(e){var t=0,n=e.changedTouches.length;for(;t<n;t++)if(e.changedTouches[t].identifier===this._observedPointer){this._releaseInterest(),this.active=!1,this.needsDraw=!0;return}}},_active:{enumerable:!1,value:!1},active:{get:function(){return this._active},set:function(e){if(e===this._active)return;this._active=e,this.needsDraw=!0}},_disabled:{enumerable:!1,value:!1},disabled:{get:function(){return this._disabled},set:function(e){if(e===this._disabled)return;this._disabled=e,this.needsDraw=!0}},_checked:{enumerable:!1,value:!1},checked:{get:function(){return this._checked},set:function(e){if(e===this._checked)return;this._checked=e,this.needsDraw=!0}},_observedPointer:{enumerable:!0,value:null},surrenderPointer:{value:function(e,t){return this._releaseInterest(),this.active=!1,!0}},_acknowledgeIntent:{value:function(e){if(!this.eventManager.claimPointer(e,this))return;this._observedPointer=e,window.Touch?(document.addEventListener("touchmove",this),document.addEventListener("touchend",this),document.addEventListener("touchcancel",this)):document.addEventListener("mouseup",this,!1),this.active=!0},enumerable:!1},_interpretInteraction:{value:function(e){if(!this.active)return;var t=e.target;while(t!==this.element&&t&&t.parentNode)t=t.parentNode;this.element===t&&(this.checked=!this.checked),this._releaseInterest(),this.active=!1},enumerable:!1},_releaseInterest:{value:function(){window.Touch?(document.removeEventListener("touchend",this),document.removeEventListener("touchcancel",this)):document.removeEventListener("mouseup",this),this.eventManager.forfeitPointer(this._observedPointer,this),this._observedPointer=null}},prepareForActivationEvents:{enumerable:!1,value:function(){window.Touch?this.element.addEventListener("touchstart",this,!1):this.element.addEventListener("mousedown",this,!1)}},prepareForDraw:{enumerable:!1,value:function(){this.element.type="checkbox";var e=document.createElement("span");e.className=this.element.className,e.classList.add("montage-Checkbox"),this._background=document.createElement("span"),this._background.classList.add("background"),this._button=document.createElement("span"),this._button.classList.add("button"),this._checkmark=document.createElement("span"),this._checkmark.classList.add("checkmark"),this.element.parentNode.insertBefore(e,this.element.nextSibling);var t=document.createDocumentFragment();t.appendChild(this._background),t.appendChild(this._button),t.appendChild(this._checkmark),t.appendChild(this.element),e.appendChild(t),this._nativeCheckbox=this.element,this.element=e}},draw:{enumerable:!1,value:function(){this._nativeCheckbox.disabled=this._disabled;var e=this.element;this.disabled?e.classList.add("disabled"):e.classList.remove("disabled"),this.active?e.classList.add("active"):e.classList.remove("active"),this._nativeCheckbox.checked=this.checked,this.checked?e.classList.add("checked"):e.classList.remove("checked")}}})