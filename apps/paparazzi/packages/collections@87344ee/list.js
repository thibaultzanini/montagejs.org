"use strict";function List(e,t,n){if(!(this instanceof List))return new List(e,t,n);var r=this.head=new this.Node;r.next=r,r.prev=r,this.contentEquals=t||Object.equals,this.getDefault=n||Function.noop,this.length=0,this.addEach(e)}function ListIterator(e){this.head=e,this.at=e.next}function Node(e){this.value=e,this.prev=null,this.next=null}module.exports=List;var Shim=require("./shim"),GenericCollection=require("./generic-collection"),GenericOrder=require("./generic-order"),PropertyChanges=require("./listen/property-changes");Object.addEach(List.prototype,GenericCollection.prototype),Object.addEach(List.prototype,GenericOrder.prototype),Object.addEach(List.prototype,PropertyChanges.prototype),List.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.getDefault)},List.prototype.find=function(e,t){t=t||this.contentEquals;var n=this.head,r=n.next;while(r!==n){if(t(r.value,e))return r;r=r.next}},List.prototype.findLast=function(e,t){t=t||this.contentEquals;var n=this.head,r=n.prev;while(r!==n){if(t(r.value,e))return r;r=r.prev}},List.prototype.has=function(e,t){return!!this.find(e,t)},List.prototype.get=function(e,t){var n=this.find(e,t);return n?n.value:this.getDefault(e)},List.prototype["delete"]=function(e,t){var n=this.findLast(e,t);return n?(n["delete"](),this.length--,!0):!1},List.prototype.clear=function(){var e;this.head.next=this.head.prev=this.head,this.length=0},List.prototype.add=function(e){return this.head.addBefore(new this.Node(e)),this.length++,!0},List.prototype.push=function(){var e=this.head;for(var t=0;t<arguments.length;t++){var n=arguments[t],r=new this.Node(n);e.addBefore(r),this.length++}},List.prototype.unshift=function(){var e=this.head;for(var t=0;t<arguments.length;t++){var n=arguments[t],r=new this.Node(n);e.addAfter(r),this.length++,e=r}},List.prototype.pop=function(){var e,t=this.head;return t.prev!==t&&(e=t.prev.value,t.prev["delete"](),this.length--),e},List.prototype.shift=function(){var e,t=this.head;return t.prev!==t&&(e=t.next.value,t.next["delete"](),this.length--),e},List.prototype.peek=function(){if(this.head!==this.head.next)return this.head.next.value},List.prototype.poke=function(e){this.head!==this.head.next?this.head.next.value=e:this.push(e)},List.prototype.one=function(){return this.peek()},List.prototype.scan=function(e,t){var n=this.head;if(typeof e=="number"){var r=e;if(r>=0){e=n.next;while(r){r--,e=e.next;if(e==n)break}}else{e=n;while(r<0){r++,e=e.prev;if(e==n)break}}return e}return e||t},List.prototype.slice=function(e,t){var n=[],r=this.head;e=this.scan(e,r.next),t=this.scan(t,r);while(e!==t&&e!==r)n.push(e.value),e=e.next;return n},List.prototype.splice=function(e,t){return this.swap(e,t,Array.prototype.slice.call(arguments,2))},List.prototype.swap=function(e,t,n){var r=[],i=e;e=this.scan(e,this.head),t===undefined&&(t=Infinity);while(t--&&t>=0&&e!==this.head)r.push(e.value),e["delete"](),e=e.next,this.length--;if(n){i===null&&e===this.head&&(e=this.head.next);for(var s=0;s<n.length;s++){var o=new this.Node(n[s]);e.addBefore(o)}this.length+=n.length}return r},List.prototype.reverse=function(){var e=this.head;do{var t=e.next;e.next=e.prev,e.prev=t,e=e.next}while(e!==this.head);return this},List.prototype.reduce=function(e,t){var n=arguments[2],r=this.head,i=r.next;while(i!==r)t=e.call(n,t,i.value,i,this),i=i.next;return t},List.prototype.reduceRight=function(e,t){var n=arguments[2],r=this.head,i=r.prev;while(i!==r)t=e.call(n,t,i.value,i,this),i=i.prev;return t},List.prototype.iterate=function(){return new ListIterator(this.head)},ListIterator.prototype.next=function(){if(this.at===this.head)throw StopIteration;var e=this.at.value;return this.at=this.at.next,e},List.prototype.Node=Node,Node.prototype["delete"]=function(){this.prev.next=this.next,this.next.prev=this.prev},Node.prototype.addBefore=function(e){var t=this.prev;this.prev=e,e.prev=t,t.next=e,e.next=this},Node.prototype.addAfter=function(e){var t=this.next;this.next=e,e.next=t,t.prev=e,e.prev=this}