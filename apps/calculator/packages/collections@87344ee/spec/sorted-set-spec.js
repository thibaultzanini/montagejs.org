require("../shim-array");var SortedSet=require("../sorted-set"),TreeLog=require("../tree-log"),describeDequeue=require("./dequeue"),describeCollection=require("./collection"),describeSet=require("./set"),Fuzz=require("./fuzz");describe("SortedSet",function(){function e(e){return new SortedSet(e)}[SortedSet,e].forEach(function(e){function t(e){this.value=e}describeCollection(e,[1,2,3,4],!0),t.prototype.compare=function(e){return Object.compare(this.value,e.value)};var n=new t(1),r=new t(2),i=new t(3),s=new t(4),o=[n,r,i,s];describeCollection(e,o,!0),describeDequeue(e),describeSet(e)}),describe("splay",function(){function e(e){var t=[];return e.log(TreeLog.ascii,null,t.push,t),t}it("should degenerate for sorted values",function(){var t=SortedSet([1,2,3]);expect(e(t)).toEqual(["  .-- 1",".-+ 2","+ 3"])}),it("should splay middle value",function(){var t=SortedSet([1,2,3]);t.get(2),expect(e(t)).toEqual([".-- 1","+ 2","'-- 3"])}),it("should splay middle value",function(){var t=SortedSet([1,2,3]);t.get(2),t.delete(1),expect(e(t)).toEqual(["+ 2","'-- 3"])})}),describe("subtree lengths",function(){function e(e){var t=[];return e.log(TreeLog.ascii,function(e,t,n){t(" "+e.value+" length="+e.length)},t.push,t),t}function t(e){if(!e)return 0;var n=1;return n+=t(e.left),n+=t(e.right),expect(e.length).toBe(n),n}function n(e,n,r){it(e+" "+n,function(){var e=SortedSet();Fuzz.execute(e,Fuzz.parse(n),r),t(e.root)})}it("+1",function(){var n=SortedSet([1]);expect(e(n)).toEqual(["- 1 length=1"]),t(n.root)}),it("+1, +2",function(){var n=SortedSet([1,2]);expect(e(n)).toEqual([".-- 1 length=1","+ 2 length=2"]),t(n.root)}),it("+1, +2, 1",function(){var n=SortedSet([1,2]);n.get(1),expect(e(n)).toEqual(["+ 1 length=2","'-- 2 length=1"]),t(n.root)}),it("+1, +3, +2",function(){var n=SortedSet([1,3,2]);expect(e(n)).toEqual([".-- 1 length=1","+ 2 length=3","'-- 3 length=1"]),t(n.root)}),n("reduction of case with propagation issue","+2, +4, +3, +1, 4");for(var r=0;r<50;r++)(function(){var e=Fuzz.make(r*5,r,Math.max(10,r*5));n("fuzz",Fuzz.stringify(e))})()}),describe("splayIndex",function(){it("should find the index of every element",function(){var e=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],t=Fuzz.makeRandom(0);e.sort(function(){return t()-.5});var n=SortedSet(e);e.forEach(function(e){n.splayIndex(e),expect(n.root.index).toBe(e),expect(n.root.value).toBe(e)})})}),describe("indexOf",function(){for(var e=0;e<20;e++)(function(e){var t=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],n=Fuzz.makeRandom(e);t.sort(function(){return n()-.5}),it("should discern the position of every value in "+t.join(", "),function(){var e=SortedSet(t);t.forEach(function(t,n){expect(e.indexOf(t)).toBe(t)})})})(e)}),describe("addRangeChangeListener",function(){for(var e=0;e<20;e++)(function(e){var t=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],n=Fuzz.makeRandom(e);t.sort(function(){return n()-.5}),it("should bind content changes to an array for "+t.join(", "),function(){var e=[],n=SortedSet();n.addRangeChangeListener(function(t,n,r){e.swap(r,n.length,t)}),n.addEach(t),expect(e.length).toBe(n.length),e.forEach(function(e,t){expect(e).toBe(t)})})})(e)}),describe("log drawings",function(){function e(e){var t=[];return e.log({intersection:"+",through:"-",branchUp:"^",branchDown:"v",fromBelow:".",fromAbove:"'",fromBoth:"x",strafe:"|"},function(e,t,n){var r=""+e.value,i=r.length,s=Array(i+1).join("-");n(" +-"+s+"-+"),t("-| "+r+" |"),t(" +-"+s+"-+")},t.push,t),t}it("should draw a simple box",function(){var t=SortedSet([1]);expect(e(t)).toEqual(["  +---+","--| 1 |","  +---+"])}),it("should draw a graph of two ascending",function(){var t=SortedSet([1,2]);expect(e(t)).toEqual(["    +---+",".---| 1 |","|   +---+","| +---+","^-| 2 |","  +---+"])}),it("should draw a graph of two descending",function(){var t=SortedSet([2,1]);expect(e(t)).toEqual(["  +---+","v-| 1 |","| +---+","|   +---+","'---| 2 |","    +---+"])}),it("should draw a graph of three",function(){var t=SortedSet([3,1,2]);expect(e(t)).toEqual(["    +---+",".---| 1 |","|   +---+","| +---+","+-| 2 |","| +---+","|   +---+","'---| 3 |","    +---+"])}),it("should draw a complex graph",function(){var t=SortedSet([8,6,5,3,7,2,1,4]);expect(e(t)).toEqual(["      +---+","  .---| 1 |","  |   +---+","  | +---+",".-+-| 2 |","| | +---+","| |   +---+","| '---| 3 |","|     +---+","| +---+","+-| 4 |","| +---+","|   +---+","'-v-| 5 |","  | +---+","  |     +---+","  | .---| 6 |","  | |   +---+","  | | +---+","  '-+-| 7 |","    | +---+","    |   +---+","    '---| 8 |","        +---+"])})})})