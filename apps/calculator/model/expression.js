var Montage=require("montage").Montage,Expression=exports.Expression=Montage.create(Montage,{OP_MINUS:{writable:!1,value:"minus"},OP_PLUS:{writable:!1,value:"plus"},OP_MULTIPLY:{writable:!1,value:"multiply"},OP_DIVIDE:{writable:!1,value:"divide"},TYPE_COMPOUND:{writable:!1,value:"Compound"},TYPE_NUMBER:{writable:!1,value:"Number"},_lhs:{value:null},_rhs:{value:null},_operator:{value:null},_comment:{value:null},_type:{value:"Number"},lhs:{get:function(){return this._lhs},set:function(e){this._lhs!==e&&(this._lhs=e)}},rhs:{get:function(){return this._rhs},set:function(e){this._rhs!==e&&(this._rhs=e)}},operator:{get:function(){return this._operator},set:function(e){this._operator!==e&&(this._operator=e)}},result:{value:function(){var e;if(this.lhs==null)return"";if(this._type===this.TYPE_NUMBER){var t=""+this.lhs;return t.indexOf(".")==-1?parseInt(this.lhs,10):parseFloat(this.lhs)}if(this._type===this.TYPE_COMPOUND)switch(this.operator){case this.OP_PLUS:e=this.lhs.result()+this.rhs;break;case this.OP_MINUS:e=this.lhs.result()-this.rhs;break;case this.OP_DIVIDE:this.rhs!=0?e=this.lhs.result()/this.rhs:e="Error";break;case this.OP_MULTIPLY:e=this.lhs.result()*this.rhs}return e}},comment:{get:function(){return this._comment},set:function(e){this._comment!==e&&(this._comment=e)}},build:{value:function(e){if(this._type==this.TYPE_NUMBER){var t=Montage.create(Expression);t.lhs=e,this.lhs=t}else this._type==this.TYPE_COMPOUND&&(this.rhs=e)}},addOperator:{value:function(e){this._type==this.TYPE_NUMBER?(this.operator=e,this._type=this.TYPE_COMPOUND):this._type==this.TYPE_COMPOUND&&(this.operator==null||this.rhs!=null?(this.lhs=this.clone(),this.operator=e,this.rhs=null):this.operator=e)}},clone:{value:function(){var e=Montage.create(Expression);return this._type==this.TYPE_NUMBER?e.lhs=this.lhs:this._type==this.TYPE_COMPOUND&&(e._type=this._type,e.lhs=this.lhs.clone(),e.rhs=this.rhs,e.operator=this.operator),e}},prettyPrint:{value:function(e){var t;switch(e){case this.OP_PLUS:t="+";break;case this.OP_MINUS:t="-";break;case this.OP_DIVIDE:t="รท";break;case this.OP_MULTIPLY:t="ร"}return t}},toString:{value:function(){if(this.lhs==null)return"";if(this._type==this.TYPE_NUMBER)return this.lhs.toString();if(this._type==this.TYPE_COMPOUND)return this.lhs.toString()+" "+this.prettyPrint(this.operator)+" "+(this.rhs==null?"":this.rhs.toString())}},displayExpression:{get:function(){return this.toString()}},displayResult:{get:function(){return this.result()}}})