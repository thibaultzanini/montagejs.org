function drain(){assert(2>=buffered),buffered=0,w.emit("drain")}var common=require("../common"),assert=require("assert"),Stream=require("../../readable"),Readable=Stream.Readable,r=new Readable,N=256,reads=0;r._read=function(){return r.push(++reads===N?null:new Buffer(1))};var rended=!1;r.on("end",function(){rended=!0});var w=new Stream;w.writable=!0;var writes=0,buffered=0;w.write=function(e){return writes+=e.length,buffered+=e.length,process.nextTick(drain),!1};var wended=!1;w.end=function(){wended=!0},r.on("readable",function(){w.emit("drain")}),r.pipe(w),process.on("exit",function(){assert(rended),assert(wended),console.error("ok")});