montageDefine("1ebf565","test/simple/test-stream2-readable-legacy-drain",{dependencies:["../common","assert","../../readable"],factory:function(e){function t(){n(2>=h),h=0,u.emit("drain")}e("../common");var n=e("assert"),r=e("../../readable"),i=r.Readable,a=new i,o=256,s=0;a._read=function(){return a.push(++s===o?null:new Buffer(1))};var l=!1;a.on("end",function(){l=!0});var u=new r;u.writable=!0;var c=0,h=0;u.write=function(e){return c+=e.length,h+=e.length,process.nextTick(t),!1};var d=!1;u.end=function(){d=!0},a.on("readable",function(){u.emit("drain")}),a.pipe(u),process.on("exit",function(){n(l),n(d),console.error("ok")})}});