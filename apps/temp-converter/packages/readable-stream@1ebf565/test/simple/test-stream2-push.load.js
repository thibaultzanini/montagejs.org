montageDefine("1ebf565","test/simple/test-stream2-push",{dependencies:["../common.js","../../readable","assert","util","events"],factory:function(e){function t(){console.error("readStart"),p=!0}function n(){console.error("readStop"),p=!1,process.nextTick(function(){var e=o.read();null!==e&&f.write(e)})}function r(){u(p),h.emit("data",g),u(p),h.emit("data",g),u(p),h.emit("data",g),u(p),h.emit("data",g),u(!p),5>b++?setTimeout(r,10):a()}function i(){console.error("finish"),u.deepEqual(m,v),console.log("ok")}function a(){h.emit("end"),u(!p),f.end(o.read()),setTimeout(function(){u(d)})}e("../common.js");var o=e("../../readable"),s=o.Readable,l=o.Writable,u=e("assert");e("util");var c=e("events").EventEmitter,o=new s({highWaterMark:16,encoding:"utf8"}),h=new c;o._read=function(){console.error("stream._read"),t()};var d=!1;o.on("end",function(){d=!0}),h.on("data",function(e){var t=o.push(e);console.error("data",o._readableState.length),t||n()}),h.on("end",function(){o.push(null)});var p=!1,f=new l({decodeStrings:!1}),m=[],v=["asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg","asdfgasdfgasdfgasdfg"];f._write=function(e,t,n){console.error("WRITE %s",e),m.push(e),process.nextTick(n)},f.on("finish",i);var g="asdfg",b=0;t(),r()}});