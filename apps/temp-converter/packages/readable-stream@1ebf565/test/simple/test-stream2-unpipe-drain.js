function TestWriter(){stream.Writable.call(this)}function TestReader(){stream.Readable.call(this),this.reads=0}var common=require("../common.js"),assert=require("assert"),stream=require("../../readable"),crypto=require("crypto"),util=require("util");util.inherits(TestWriter,stream.Writable),TestWriter.prototype._write=function(){console.log("write called")};var dest=new TestWriter;util.inherits(TestReader,stream.Readable),TestReader.prototype._read=function(e){this.reads+=1,this.push(crypto.randomBytes(e))};var src1=new TestReader,src2=new TestReader;src1.pipe(dest),src1.once("readable",function(){process.nextTick(function(){src2.pipe(dest),src2.once("readable",function(){process.nextTick(function(){src1.unpipe(dest)})})})}),process.on("exit",function(){assert.equal(src1.reads,2),assert.equal(src2.reads,2)});