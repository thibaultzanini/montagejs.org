montageDefine("1bfc0c5","core/meta/blueprint-reference",{dependencies:["montage","core/promise","core/meta/blueprint","core/meta/binder","core/meta/remote-reference","core/meta/binder-reference","core/logger"],factory:function(e,t,n){"use strict";var r=e("montage").Montage,i=e("core/promise").Promise,s=e("core/meta/blueprint"),o=e("core/meta/binder"),u=e("core/meta/remote-reference").RemoteReference,a=e("core/meta/binder-reference").BinderReference,f=e("core/logger").logger("blueprint");t.BlueprintReference=u.create(u,{identifier:{get:function(){return this._reference||(this._reference=this.referenceFromValue(this._value)),["blueprint",this._reference.blueprintName.toLowerCase(),"reference"].join("_")}},valueFromReference:{value:function(e,t){var n=e.blueprintName,r=e.blueprintModuleId,u=e.prototypeName,f=e.moduleId,l=e.binderReference,c=i.resolve(o.Binder.manager.defaultBinder);l&&(c=a.valueFromReference(l,t));var h=i.defer();return c.then(function(e){if(e){var n=e.blueprintForPrototype(u,f);if(n)h.resolve(n);else try{var i=t,o=r.indexOf("/");if(o>0){var a=r.substring(0,o),l=t.mappings;a in l&&(r=r.substring(o+1),i=i.getPackage(l[a].location))}s.Blueprint.getBlueprintWithModuleId(r,i).then(function(t){t?(e.addBlueprint(t),h.resolve(t)):h.reject(new Error("Error cannot find Blueprint "+r))},h.reject)}catch(c){h.reject(new Error("Error cannot find Blueprint "+r))}}else try{h=s.Blueprint.getBlueprintWithModuleId(r,t)}catch(c){h.reject(new Error("Error cannot find Blueprint "+r))}}),h.promise}},referenceFromValue:{value:function(e){var t={};return t.blueprintName=e.name,t.blueprintModuleId=e.blueprintModuleId,t.prototypeName=e.prototypeName,t.moduleId=e.moduleId,e.binder&&!e.binder.isDefault&&(t.binderReference=a.referenceFromValue(e.binder)),t}}})}})